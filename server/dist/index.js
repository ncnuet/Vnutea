(()=>{"use strict";var e={3114:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(3518),a=i(n(5343)),{CLOUDINARY_CLOUD_NAME:o,CLOUDINARY_API_KEY:s,CLOUDINARY_API_SECRET:c}=a.default;r.v2.config({cloud_name:o,api_key:s,api_secret:c}),t.default=r.v2},4742:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.withAge=t.cookieSecureOption=void 0,t.cookieSecureOption={httpOnly:!0,secure:!0},t.withAge=function(e){return Object.assign(Object.assign({},t.cookieSecureOption),{maxAge:e})}},2009:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,a){function o(e){try{c(i.next(e))}catch(e){a(e)}}function s(e){try{c(i.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}c((i=i.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.connect=void 0;const a=r(n(1185)),o=r(n(5343)),{MG_HOST:s,MG_NAME:c,MG_USERNAME:d,MG_PASSWORD:u,MONGODB_URI:l}=o.default;a.default.set("strictQuery",!0);const f=l||`mongodb+srv://${d}:${u}@${s}/${c}?retryWrites=true&w=majority`;t.connect=()=>i(void 0,void 0,void 0,(function*(){return a.default.connect(f)}))},5343:function(e,t,n){var i=this&&this.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.env=void 0;const a=n(5142),o=r(n(1017)),s=process.env,{NODE_ENV:c}=s,d=i(s,["NODE_ENV"])||{},u=(0,a.config)("dev"===c?{path:o.default.resolve(process.cwd(),".env.dev")}:void 0).parsed;t.env="production",t.default=Object.assign(Object.assign(Object.assign({},u),{ENV:"production"}),d)},1633:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.JWTResetOpt=t.JWTRefreshOpt=t.JWTTokenOpt=void 0;const r=i(n(5343));t.JWTTokenOpt={expiresIn:"dev"===r.default.ENV?"10s":"3600s"},t.JWTRefreshOpt={expiresIn:"dev"===r.default.ENV?"3600s":"86400s"},t.JWTResetOpt={expiresIn:"dev"===r.default.ENV?"180s":"300s"}},9818:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,a){function o(e){try{c(i.next(e))}catch(e){a(e)}}function s(e){try{c(i.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}c((i=i.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.startup=t.setupRedisIndex=t.redis=void 0;const a=n(7773),o=r(n(5343)),s=n(9372);function c(){return i(this,void 0,void 0,(function*(){yield(0,s.setTokenIndex)()}))}t.redis=(0,a.createClient)({password:o.default.RD_PASSWORD,socket:{host:o.default.RD_HOST,port:Number(o.default.RD_PORT)}}),t.setupRedisIndex=c,t.startup=function(){return i(this,void 0,void 0,(function*(){yield t.redis.connect(),yield c()}))}},6464:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,a){function o(e){try{c(i.next(e))}catch(e){a(e)}}function s(e){try{c(i.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}c((i=i.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=n(5417),o=n(4742),s=n(7797),c=r(n(9412)),d=r(n(4747)),u=r(n(5215)),l=r(n(4947)),f=n(2790),h=r(n(9660)),p=r(n(7315)),v=r(n(5805)),m=r(n(8047)),y=r(n(7649)),_=r(n(203)),g=r(n(7148));class w{static precheck(e){return i(this,void 0,void 0,(function*(){if(e.department&&0===(yield g.default.get([e.department])).length)throw new a.InputError("Invalid department id","department")}))}static login(e,t){return i(this,void 0,void 0,(function*(){const n=e.body;console.log(n),yield(0,c.default)(t,(()=>i(this,void 0,void 0,(function*(){d.default.validateLogin(n);const e=yield u.default.findUserByPassword(n.username,n.password);if(e){const i=(yield l.default.getVersion(e.uid))||"0",r=(0,s.generateToken)(Object.assign(Object.assign({},e),{version:i,remember:n.remember}),!0);yield l.default.insertRefreshToken(r.refreshToken,e.uid,e.role),function(e,t,n,i){i&&e.cookie("refresh_token",i,(0,o.withAge)(864e5)),e.status(200).cookie("token",n,(0,o.withAge)(t?36e5:void 0)).json({message:"success",data:{accessToken:n,refreshToken:i}}).send()}(t,n.remember,r.accessToken,r.refreshToken)}else t.status(401).json({message:"Invalid username or password",name:"password"})}))))}))}static logout(e,t){return i(this,void 0,void 0,(function*(){const e=t.locals.user;yield(0,c.default)(t,(()=>i(this,void 0,void 0,(function*(){l.default.deleteRefreshToken(e.uid),l.default.updateVersion(e.uid),t.cookie("token",null,(0,o.withAge)(0)),t.cookie("refresh_token",null,(0,o.withAge)(0)),t.sendStatus(200)}))))}))}static create(e,t){return i(this,void 0,void 0,(function*(){const n=e.body,r=t.locals.user;(0,c.default)(t,(()=>i(this,void 0,void 0,(function*(){_.default.validateCreate(n),yield w.precheck(n);const e=yield v.default.create(r.uid,{name:n.name,username:n.username,role:n.role});var i=null;n.role===f.EUserRole.STUDENT?(m.default.validateCreate(Object.assign(Object.assign({},n),{user:e})),i=yield p.default.create({creator:r.uid,department:n.department,name:n.name,user:e})):n.role===f.EUserRole.TEACHER&&(y.default.validateCreate(Object.assign(Object.assign({},n),{user:e})),i=yield h.default.create({creator:r.uid,department:n.department,name:n.name,user:e})),t.json({message:"Created successfully",data:{id:e,password:"123456789",role:n.role,profile_id:i}})}))))}))}static delete(e,t){return i(this,void 0,void 0,(function*(){const n=e.params.id;(0,c.default)(t,(()=>i(this,void 0,void 0,(function*(){_.default.validateDelete({id:n});const e=yield v.default.delete(n),i=(yield h.default.delete(n))&&(yield p.default.delete(n));t.status(200).json({message:e&&i?"Delete successfully":"Unable to delete",data:{id:n}})}))))}))}}t.default=w},6319:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,a){function o(e){try{c(i.next(e))}catch(e){a(e)}}function s(e){try{c(i.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}c((i=i.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=r(n(7035)),o=r(n(6362)),s=r(n(9412)),c=r(n(4216));t.default=new class{createMessage(e,t){return i(this,void 0,void 0,(function*(){const n=t.locals.user,r=(e.params.roomID,e.body);(0,s.default)(t,(()=>i(this,void 0,void 0,(function*(){if(c.default.validateCreateMessage(r),!(yield o.default.getRoom(r.roomID,n.uid)))throw new Error("Invalid roomID",{cause:"roomID"});yield a.default.createMessage(r.roomID,n.uid,r.message,r.type),t.json({message:"success"})}))))}))}}},7022:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,a){function o(e){try{c(i.next(e))}catch(e){a(e)}}function s(e){try{c(i.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}c((i=i.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=n(5417),o=r(n(9412)),s=r(n(3211)),c=r(n(2237)),d=r(n(7315)),u=r(n(9660)),l=r(n(4003));class f{static precheck(e){return i(this,void 0,void 0,(function*(){if(e.students&&(yield d.default.get(e.students)).length!=e.students.length)throw new a.InputError("Invalid students ref","students");if(e.teacher&&0===(yield u.default.get([e.teacher])).length)throw new a.InputError("Invalid teachers ref","teachers")}))}static create(e,t){return i(this,void 0,void 0,(function*(){const n=t.locals.user,r=e.body;console.log(e.body),(0,o.default)(t,(()=>i(this,void 0,void 0,(function*(){s.default.validateCreate(r),yield f.precheck(r);const e=yield c.default.create({classID:r.classID,creator:n.uid,description:r.description,name:r.name,students:r.students,teacher:r.teacher});t.status(200).json({message:"Created successfully",data:{id:e}})}))))}))}static delete(e,t){return i(this,void 0,void 0,(function*(){const n=e.params.id;(0,o.default)(t,(()=>i(this,void 0,void 0,(function*(){s.default.validateDelete({id:n});const e=yield c.default.delete(n);t.status(200).send({message:e?"Deleted successfully":"Unable to delete",data:{id:n}})}))))}))}static addComment(e,t){return i(this,void 0,void 0,(function*(){const n=e.params.id,r=t.locals.user,a=e.body;(0,o.default)(t,(()=>i(this,void 0,void 0,(function*(){l.default.validateCreate(Object.assign(Object.assign({},a),{id:n}));const e=yield c.default.addComment(n,{creator:r.uid,content:a.content});t.status(200).json({message:e?"Created comment successfully":"Unable to create comment"})}))))}))}static deleteComment(e,t){return i(this,void 0,void 0,(function*(){const{id:n,cid:r}=e.params,a=t.locals.user;(0,o.default)(t,(()=>i(this,void 0,void 0,(function*(){l.default.validateDelete({id:n,cid:r});const e=yield c.default.deleteComment(n,{creator:a.uid,cid:r});t.status(200).json({message:e?"Deleted comment successfully":"Unable to delete comment"})}))))}))}}t.default=f},8964:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,a){function o(e){try{c(i.next(e))}catch(e){a(e)}}function s(e){try{c(i.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}c((i=i.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=n(5417),o=r(n(9412)),s=r(n(3114)),c=r(n(9416)),d=r(n(5805)),u=n(2790),l=r(n(7148));class f{static precheck(e){return i(this,void 0,void 0,(function*(){if(e.dean){const t=yield d.default.getUsers([e.dean]);if(0===t.length)throw new a.InputError("Invalid dean id","dean");if(t[0].role!==u.EUserRole.TEACHER)throw new a.InputError("Invalid role of dean","dean")}}))}static create(e,t){return i(this,void 0,void 0,(function*(){const n=t.locals.user,r=e.body,a=e.files;(0,o.default)(t,(()=>i(this,void 0,void 0,(function*(){r.contact="string"==typeof r.contact?JSON.parse(r.contact):r.contact,r.details="string"==typeof r.details?JSON.parse(r.details):r.details,c.default.validateCreate(Object.assign(Object.assign({},r),{image:a?"true":void 0})),yield f.precheck(r);const e=a.image,i=yield s.default.uploader.upload(e.tempFilePath,{public_id:e.name,resource_type:"auto",folder:"uploaded",use_filename:!0,unique_filename:!1});if(i.secure_url){const e=yield l.default.create({image:i.secure_url,dean:r.dean,contact:r.contact,name:r.name,description:r.description,details:r.details,creator:n.uid});t.status(200).send({message:"Success",data:{id:e}})}else t.status(500).send({message:"Unable to upload image"})}))))}))}static delete(e,t){return i(this,void 0,void 0,(function*(){const n=e.params.id;(0,o.default)(t,(()=>i(this,void 0,void 0,(function*(){c.default.validateDelete({id:n});const e=yield l.default.delete(n);t.status(200).send({message:e?"Deleted successfully":"Unable to delete",data:{id:n}})}))))}))}}t.default=f},1329:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,a){function o(e){try{c(i.next(e))}catch(e){a(e)}}function s(e){try{c(i.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}c((i=i.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=n(5417),o=r(n(9412)),s=r(n(3114)),c=r(n(5805)),d=n(2790),u=r(n(7148)),l=r(n(8937)),f=r(n(608));class h{static precheck(e){return i(this,void 0,void 0,(function*(){if(e.dean){const t=yield c.default.getUsers([e.dean]);if(0===t.length)throw new a.InputError("Invalid dean id","dean");if(t[0].role!==d.EUserRole.TEACHER)throw new a.InputError("Invalid role of dean","dean")}if(e.department&&0===(yield u.default.get([e.department])).length)throw new a.InputError("Invalid department id","department")}))}static create(e,t){return i(this,void 0,void 0,(function*(){const n=t.locals.user,r=e.body,a=e.files;(0,o.default)(t,(()=>i(this,void 0,void 0,(function*(){r.contact="string"==typeof r.contact?JSON.parse(r.contact):r.contact,r.details="string"==typeof r.details?JSON.parse(r.details):r.details,l.default.validateCreate(Object.assign(Object.assign({},r),{image:a?"true":void 0})),yield h.precheck(r);const e=a.image,i=yield s.default.uploader.upload(e.tempFilePath,{public_id:e.name,resource_type:"auto",folder:"uploaded",use_filename:!0,unique_filename:!1});if(i.secure_url){const e=yield f.default.create({image:i.secure_url,dean:r.dean,contact:r.contact,name:r.name,description:r.description,details:r.details,creator:n.uid,department:r.department});t.status(200).send({message:"Success",data:{id:e}})}else t.status(500).send({message:"Unable to upload image"})}))))}))}static delete(e,t){return i(this,void 0,void 0,(function*(){const n=e.params.id;(0,o.default)(t,(()=>i(this,void 0,void 0,(function*(){l.default.validateDelete({id:n});const e=yield f.default.delete(n);t.status(200).send({message:e?"Deleted successfully":"Unable to delete",data:{id:n}})}))))}))}}t.default=h},4107:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,a){function o(e){try{c(i.next(e))}catch(e){a(e)}}function s(e){try{c(i.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}c((i=i.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=r(n(7148)),o=r(n(608)),s=n(9125),c=r(n(9660)),d=r(n(5805)),u=n(5417),l=r(n(9412)),f=r(n(1529));class h{static checkValidFavouriteRef(e){return i(this,void 0,void 0,(function*(){switch(e.type){case s.EFavouriteType.TEACHER:if(0===(yield c.default.get([e.ref])).length)throw new u.InputError("Invalid ref id","ref");break;case s.EFavouriteType.DEPARTMENT:if(0===(yield a.default.get([e.ref])).length)throw new u.InputError("Invalid ref id","ref");break;case s.EFavouriteType.LAB:if(0===(yield o.default.get([e.ref])).length)throw new u.InputError("Invalid ref id","ref")}}))}static getProfile(e,t){return i(this,void 0,void 0,(function*(){const e=t.locals.user;(0,l.default)(t,(()=>i(this,void 0,void 0,(function*(){t.status(200).json({message:"successfully",data:{role:e.role,username:e.username,name:e.name}})}))))}))}static addFavorite(e,t){return i(this,void 0,void 0,(function*(){const n=t.locals.user,r=e.body;(0,l.default)(t,(()=>i(this,void 0,void 0,(function*(){console.log(r),f.default.validateAddFavourite(r),yield h.checkValidFavouriteRef(r);const e=d.default.addFavorite(n.uid,r);t.json({message:e?"Added successfully":"Unable to add"})}))))}))}static getFavorite(e,t){return i(this,void 0,void 0,(function*(){const e=t.locals.user;(0,l.default)(t,(()=>i(this,void 0,void 0,(function*(){const n=yield d.default.getFavourites(e.uid);t.status(200).json({message:"success",data:{favorites:n}})}))))}))}}t.default=h},4340:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,a){function o(e){try{c(i.next(e))}catch(e){a(e)}}function s(e){try{c(i.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}c((i=i.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=r(n(8101)),o=n(5417),s=r(n(9412)),c=r(n(4539)),d=r(n(3114)),u=n(6638),l=r(n(5805)),f=n(2790),h=r(n(7148)),p=r(n(608));class v{static precheck(e){return i(this,void 0,void 0,(function*(){switch(e.type){case u.EOutstandingType.TEACHER:const t=yield l.default.getUsers([e.ref]);if(0===t.length)throw new o.InputError("Invalid ref id","ref");if(t[0].role!==f.EUserRole.TEACHER)throw new o.InputError("Invalid role ref","ref");break;case u.EOutstandingType.DEPARTMENT:if(0===(yield h.default.get([e.ref])).length)throw new o.InputError("Invalid ref id","ref");break;case u.EOutstandingType.LAB:if(0===(yield p.default.get([e.ref])).length)throw new o.InputError("Invalid ref id","ref")}}))}static create(e,t){return i(this,void 0,void 0,(function*(){const n=t.locals.user,r=e.body,o=e.files;(0,s.default)(t,(()=>i(this,void 0,void 0,(function*(){c.default.validateCreate(Object.assign(Object.assign({},r),{image:o?"true":void 0})),yield v.precheck(r);const e=o.image,i=yield d.default.uploader.upload(e.tempFilePath,{public_id:e.name,resource_type:"auto",folder:"uploaded",use_filename:!0,unique_filename:!1});if(i.secure_url){const e=yield a.default.create({image:i.secure_url,ref:r.ref,type:r.type,creator:n.uid});t.status(200).send({message:"Success",data:{id:e}})}else t.status(500).send({message:"Unable to upload image"})}))))}))}static delete(e,t){return i(this,void 0,void 0,(function*(){const n=e.params.id;(0,s.default)(t,(()=>i(this,void 0,void 0,(function*(){c.default.validateDelete({id:n});const e=yield a.default.delete(n);t.status(200).send({message:e?"Deleted successfully":"Unable to delete",data:{id:n}})}))))}))}}t.default=v},8665:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,a){function o(e){try{c(i.next(e))}catch(e){a(e)}}function s(e){try{c(i.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}c((i=i.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=r(n(6362)),o=r(n(5805)),s=r(n(9412)),c=r(n(4216));t.default=new class{createRoom(e,t){return i(this,void 0,void 0,(function*(){const n=t.locals.user,r=e.body;(0,s.default)(t,(()=>i(this,void 0,void 0,(function*(){if(c.default.validateCreateRoom(r),!(yield o.default.validateUID(r.participants)))return void t.status(400).json({message:"Invalid participant IDs"});const e=yield a.default.findByParticipants(r.participants);if(e)t.status(200).json({message:"The room has been created previously",data:{is_new:!1,room_id:e._id}});else{const e=yield a.default.createRoom(n.uid,r.participants,r.name);t.status(200).json({message:"The room has been created successfully",data:{is_new:!0,room_id:e._id}})}}))))}))}deleteRoom(e,t){return i(this,void 0,void 0,(function*(){const n=t.locals.user,r=e.params.roomID;(0,s.default)(t,(()=>i(this,void 0,void 0,(function*(){c.default.validateDeleteRoom({roomID:r}),(yield a.default.deleteRoom(r,n.uid))?t.status(200).json({message:"The room has been deleted successfully",data:{roomID:r}}):t.status(400).json({message:"You have not permission to delete this room",data:{roomID:r}})}))))}))}getRoomByID(e,t){return i(this,void 0,void 0,(function*(){const n=t.locals.user,r=e.params.roomID;(0,s.default)(t,(()=>i(this,void 0,void 0,(function*(){c.default.validateGetRoom({roomID:r});const e=yield a.default.getRoom(r,n.uid);t.json({message:"success",data:{room:e}})}))))}))}updateRoomName(e,t){return i(this,void 0,void 0,(function*(){const n=t.locals.user,{name:r}=e.body,o=e.params.roomID;(0,s.default)(t,(()=>i(this,void 0,void 0,(function*(){c.default.validateUpdateRoom({roomID:o});const e=yield a.default.updateRoom(o,n.uid,r);t.json({message:"success",data:e})}))))}))}}},7782:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,a){function o(e){try{c(i.next(e))}catch(e){a(e)}}function s(e){try{c(i.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}c((i=i.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=r(n(2237)),o=r(n(7148)),s=r(n(608)),c=r(n(9660)),d=r(n(9412));t.default=class{static search(e,t){return i(this,void 0,void 0,(function*(){const n=e.query;(0,d.default)(t,(()=>i(this,void 0,void 0,(function*(){const[e,i,r,d]=yield Promise.all([c.default.search(n.query),s.default.search(n.query),o.default.search(n.query),a.default.search(n.query)]);t.status(200).json({message:"success",data:{query:n.query,users:e,labs:i,departments:r,classes:d}})}))))}))}}},3607:function(e,t,n){e=n.nmd(e);var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,r)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return r(t,e),t},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,a){function o(e){try{c(i.next(e))}catch(e){a(e)}}function s(e){try{c(i.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}c((i=i.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const c=s(n(6860)),d=s(n(7806)),u=s(n(9470)),l=s(n(6674)),f=s(n(9710)),h=a(n(3582)),p=n(3952),v=n(8849),m=s(n(8479)),y=s(n(5343)),_=a(n(2009)),g=a(n(9818)),w=(0,c.default)(),b=y.default.PORT,O=(0,v.createServer)(w);w.use((0,u.default)("tiny")),w.use((0,d.default)()),w.use(c.default.json()),w.use(c.default.urlencoded({extended:!0})),w.use((0,f.default)()),w.use((0,l.default)({useTempFiles:!0,limits:{fileSize:52428800}})),w.use(h.default({origin:y.default.CORS_ORIGIN,credentials:!0,methods:["GET","PUT","POST","DELETE"],optionsSuccessStatus:200})),(0,m.default)(w),new p.Server(O).on("connection",(e=>{console.log("a user connected"),e.emit("test","Hello Testing event!")})),n.c[n.s]===e&&O.listen(b,(()=>o(void 0,void 0,void 0,(function*(){yield g.startup(),console.log("📕 [redis]: Connected to redis"),yield _.connect(),console.log("📒 [mongo]: Connected to mysql"),console.log(`✅ [server]: Server is running at http://localhost:${b}`)})))),t.default=w},322:function(e,t,n){var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,r)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return r(t,e),t},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,a){function o(e){try{c(i.next(e))}catch(e){a(e)}}function s(e){try{c(i.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}c((i=i.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.checkJWT=void 0;const c=a(n(9344)),d=s(n(5343)),u=n(5326),l=s(n(4947));t.checkJWT=function(e,t,n){return o(this,void 0,void 0,(function*(){const i=this&&"query"===this.tokenOn?e.query.token:e.cookies.token;if(!i)return t.sendStatus(401);try{const e=c.verify(i,d.default.JWT_KEY),r=yield l.default.getVersion(e.uid);if(r&&r!==e.version)return t.sendStatus(401);t.locals.user=e,n()}catch(i){if(!(i instanceof c.TokenExpiredError))return console.log(i),t.sendStatus(401);(0,u.checkRWT)(e,t,n)}}))}},5326:function(e,t,n){var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,r)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return r(t,e),t},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,a){function o(e){try{c(i.next(e))}catch(e){a(e)}}function s(e){try{c(i.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}c((i=i.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.checkRWT=void 0;const c=a(n(9344)),d=s(n(5343)),u=n(7797),l=s(n(4947)),f=n(4742),h=s(n(9412));t.checkRWT=function(e,t,n){return o(this,void 0,void 0,(function*(){const i=e.cookies.refresh_token;(0,h.default)(t,(()=>o(this,void 0,void 0,(function*(){if(!i||!(yield l.default.getRefreshToken(i)))return t.sendStatus(401);try{const e=c.verify(i,d.default.JWT_REFRESH_KEY);e.role=yield l.default.getRole(e.uid),e.version=yield l.default.getVersion(e.uid);const r=(0,u.generateToken)(e,!0);yield l.default.insertRefreshToken(r.refreshToken,e.uid,e.role),t.cookie("refresh_token",r.refreshToken,(0,f.withAge)(864e5)).cookie("token",r.accessToken,(0,f.withAge)(e.remember?36e5:void 0)).locals.user=e,n()}catch(e){console.log(e),t.sendStatus(401)}}))))}))}},944:function(e,t){var n=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,a){function o(e){try{c(i.next(e))}catch(e){a(e)}}function s(e){try{c(i.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.checkRole=void 0,t.checkRole=function(e,t,i){return n(this,void 0,void 0,(function*(){const{role:e}=t.locals.user;if(!e||!this.role.includes(e))return t.sendStatus(401);i()}))}},5215:function(e,t,n){var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,r)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return r(t,e),t},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,a){function o(e){try{c(i.next(e))}catch(e){a(e)}}function s(e){try{c(i.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const s=n(6820),c=a(n(8432));t.default=new class{findUserByPassword(e,t){return o(this,void 0,void 0,(function*(){const n=yield s.UserBaseModel.findOne({username:e},{_id:1,role:1,username:1,password:1,name:1}).exec();if(!n)return;const{_id:i,username:r,password:a,role:o,name:d}=n;return t?(yield c.compare(t,a))&&{uid:i.toString(),username:r,role:o,name:d}:void 0}))}findUserByInfo(e){return o(this,void 0,void 0,(function*(){const t=yield s.UserBaseModel.findOne({$or:[{username:e.username},{email:e.email},{_id:e.uid}]},{email:!0,username:!0,phone:!0,_id:!0}).exec();if(!t)return;const{username:n,_id:i,email:r}=t;return{username:n,uid:i.toString(),email:r}}))}}},9723:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ClassBaseModel=void 0;const i=n(1185),r=n(2412);t.ClassBaseModel=(0,i.model)("Class",r.ClassSchema)},6479:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DepartmentBaseModel=void 0;const i=n(1185),r=n(4448);t.DepartmentBaseModel=(0,i.model)("Department",r.DepartmentSchema)},1217:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LabBaseModel=void 0;const i=n(1185),r=n(7581);t.LabBaseModel=(0,i.model)("Lab",r.LabSchema)},3069:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MessageBaseModel=void 0;const i=n(1185),r=n(2045);t.MessageBaseModel=(0,i.model)("Message",r.MessageSchema)},2649:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OutstandingBaseModel=void 0;const i=n(1185),r=n(6638);t.OutstandingBaseModel=(0,i.model)("Outstanding",r.OutstandingSchema)},7964:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RoomBaseModel=void 0;const i=n(1185),r=n(9978);t.RoomBaseModel=(0,i.model)("ChatRoom",r.RoomSchema)},1778:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.StudentBaseModel=void 0;const r=n(1185),a=i(n(4315));t.StudentBaseModel=(0,r.model)("Student",a.default)},18:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TeacherBaseModel=void 0;const i=n(1185),r=n(1868);t.TeacherBaseModel=(0,i.model)("Teacher",r.TeacherSchema)},6820:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.UserBaseModel=void 0;const r=n(1185),a=i(n(5102));t.UserBaseModel=(0,r.model)("User",a.default)},7035:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,a){function o(e){try{c(i.next(e))}catch(e){a(e)}}function s(e){try{c(i.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=n(2045),a=n(3069);t.default=new class{createMessage(e,t,n,o=r.MESSAGE_TYPES.TEXT){return i(this,void 0,void 0,(function*(){yield a.MessageBaseModel.create({roomID:e,message:n,createdBy:t,type:o,seenBy:{uid:t}})}))}}},2237:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,a){function o(e){try{c(i.next(e))}catch(e){a(e)}}function s(e){try{c(i.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=n(9723);t.default=class{static create(e){return i(this,void 0,void 0,(function*(){const{creator:t,description:n,name:i,students:a,teacher:o,classID:s}=e;return(yield r.ClassBaseModel.create({creator:t,description:n,name:i,students:a,teacher:o,classID:s,rating:4.8,comments:[]}))._id.toString()}))}static delete(e){return i(this,void 0,void 0,(function*(){return(yield r.ClassBaseModel.deleteOne({_id:e}).exec()).acknowledged}))}static search(e){return i(this,void 0,void 0,(function*(){return(yield r.ClassBaseModel.search({match:{name:{query:e,fuzziness:"auto",fuzzy_transpositions:!0}}},{hydrate:!0,hydrateOptions:{select:"name _id"}})).body.hits.hydrated}))}static get(e){return i(this,void 0,void 0,(function*(){return yield r.ClassBaseModel.find({_id:{$in:e}}).exec()}))}static addComment(e,t){return i(this,void 0,void 0,(function*(){return(yield r.ClassBaseModel.updateOne({_id:e},{$push:{comments:{creator:t.creator,content:t.content}}})).acknowledged}))}static deleteComment(e,t){return i(this,void 0,void 0,(function*(){return(yield r.ClassBaseModel.updateOne({_id:e},{$pull:{comments:{_id:t.cid,creator:t.creator}}})).acknowledged}))}}},7148:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,a){function o(e){try{c(i.next(e))}catch(e){a(e)}}function s(e){try{c(i.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=n(6479);t.default=class{static create(e){return i(this,void 0,void 0,(function*(){const{name:t,dean:n,description:i,contact:a,details:o,image:s,creator:c}=e;return(yield r.DepartmentBaseModel.create({name:t,dean:n,description:i,contact:a,details:o,image:s,creator:c}))._id}))}static delete(e){return i(this,void 0,void 0,(function*(){return(yield r.DepartmentBaseModel.deleteOne({_id:e}).exec()).acknowledged}))}static search(e){return i(this,void 0,void 0,(function*(){return(yield r.DepartmentBaseModel.search({match:{name:{query:e,fuzziness:"auto",fuzzy_transpositions:!0}}},{hydrate:!0,hydrateOptions:{select:"name _id"}})).body.hits.hydrated}))}static get(e){return i(this,void 0,void 0,(function*(){return yield r.DepartmentBaseModel.find({_id:{$in:e}}).exec()}))}}},608:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,a){function o(e){try{c(i.next(e))}catch(e){a(e)}}function s(e){try{c(i.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=n(1217);t.default=class{static create(e){return i(this,void 0,void 0,(function*(){const{name:t,dean:n,description:i,contact:a,details:o,image:s,creator:c,department:d}=e;return(yield r.LabBaseModel.create({name:t,dean:n,description:i,contact:a,details:o,image:s,creator:c,department:d}))._id}))}static delete(e){return i(this,void 0,void 0,(function*(){return(yield r.LabBaseModel.deleteOne({_id:e}).exec()).acknowledged}))}static search(e){return i(this,void 0,void 0,(function*(){return(yield r.LabBaseModel.search({match:{name:{query:e,fuzziness:"auto",fuzzy_transpositions:!0}}},{hydrate:!0,hydrateOptions:{select:"name _id"}})).body.hits.hydrated}))}static get(e){return i(this,void 0,void 0,(function*(){return yield r.LabBaseModel.find({_id:{$in:e}}).exec()}))}}},8101:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,a){function o(e){try{c(i.next(e))}catch(e){a(e)}}function s(e){try{c(i.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=n(2649);t.default=class{static create(e){return i(this,void 0,void 0,(function*(){const{creator:t,image:n,ref:i,type:a}=e;return(yield r.OutstandingBaseModel.create({creator:t,image:n,ref:i,type:a}))._id}))}static delete(e){return i(this,void 0,void 0,(function*(){return(yield r.OutstandingBaseModel.deleteOne({_id:e}).exec()).acknowledged}))}static get(){return i(this,void 0,void 0,(function*(){return yield r.OutstandingBaseModel.find().exec()}))}}},6362:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,a){function o(e){try{c(i.next(e))}catch(e){a(e)}}function s(e){try{c(i.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}c((i=i.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=n(7964);var o=r(n(1185)).default.Types.ObjectId;t.default=new class{findByParticipants(e){return i(this,void 0,void 0,(function*(){return(yield a.RoomBaseModel.findOne({participants:{$size:e.length,$all:[...e]}}).exec())||void 0}))}createRoom(e,t,n){return i(this,void 0,void 0,(function*(){return t.push(e),yield a.RoomBaseModel.create({name:n,initiator:e,participants:t,room_type:t.length>2?"group":"P2P"})}))}deleteRoom(e,t){return i(this,void 0,void 0,(function*(){return(yield a.RoomBaseModel.deleteOne({_id:e,initiator:t}).exec()).deletedCount>0&&e}))}getRoom(e,t){return i(this,void 0,void 0,(function*(){return yield a.RoomBaseModel.findOne({_id:e,participants:{$elemMatch:{$eq:new o(t)}}}).exec()}))}getRoomHasUser(e){return i(this,void 0,void 0,(function*(){return yield a.RoomBaseModel.find({participants:{$elemMatch:{$eq:new o(e)}}}).exec()}))}updateRoom(e,t,n){return i(this,void 0,void 0,(function*(){return(yield a.RoomBaseModel.updateOne({_id:e,participants:{$elemMatch:{$eq:new o(t)}}},{name:n}).exec()).modifiedCount>0&&e}))}}},2412:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ClassSchema=void 0;const r=n(1185),a=i(n(3464)),o=n(7629),s=new r.Schema({name:{type:String,required:!0,es_index:!0},classID:{type:String,required:!0,es_index:!0},teacher:{type:r.Schema.Types.ObjectId,required:!0},description:{type:String},creator:{type:r.Schema.Types.ObjectId,required:!0},students:{type:[r.Schema.Types.ObjectId],required:!0},rating:{type:Number,required:!0},comments:{type:[o.CommentSchema],required:!0}},{timestamps:!0});t.ClassSchema=s,s.plugin(a.default)},7629:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CommentSchema=void 0;const i=n(1185);t.CommentSchema=new i.Schema({creator:{type:i.Schema.Types.ObjectId,required:!0},content:{type:String,required:!0}},{timestamps:!0})},6304:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ContactSchema=void 0;const i=n(1185);t.ContactSchema=new i.Schema({phones:{type:[String],required:!0},emails:{type:[String],required:!0},social:{type:[String]}})},4448:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.DepartmentSchema=void 0;const r=n(1185),a=n(6304),o=n(4919),s=i(n(3464)),c=new r.Schema({name:{type:String,required:!0,es_index:!0},dean:{type:r.Schema.Types.ObjectId,required:!0},description:{type:String},contact:{type:a.ContactSchema,required:!0},details:{type:[o.DetailSchema],required:!0},image:{type:String,required:!0},creator:{type:r.Schema.Types.ObjectId,required:!0}});t.DepartmentSchema=c,c.plugin(s.default)},4919:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DetailSchema=void 0;const i=n(1185);t.DetailSchema=new i.Schema({title:{type:String,required:!0},content:{type:[String],required:!0}})},9125:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FavoriteSchema=t.EFavouriteType=void 0;const i=n(1185);var r;!function(e){e.TEACHER="teacher",e.LAB="lab",e.DEPARTMENT="department"}(r||(t.EFavouriteType=r={}));const a=new i.Schema({name:{type:String,required:!0},type:{type:String,required:!0},ref:{type:i.Schema.Types.ObjectId}},{timestamps:!0});t.FavoriteSchema=a},7581:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.LabSchema=void 0;const r=n(1185),a=n(6304),o=n(4919),s=i(n(3464)),c=new r.Schema({name:{type:String,required:!0,es_index:!0},dean:{type:r.Schema.Types.ObjectId,required:!0},description:{type:String},contact:{type:a.ContactSchema,required:!0},details:{type:[o.DetailSchema],required:!0},image:{type:String,required:!0},creator:{type:r.Schema.Types.ObjectId,required:!0},department:{type:r.Schema.Types.ObjectId,required:!0}});t.LabSchema=c,c.plugin(s.default)},2045:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MessageSchema=t.MESSAGE_TYPES=void 0;const i=n(1185),r=n(5355),a=n(6820);var o,s=i.Schema.Types.ObjectId;!function(e){e.TEXT="text",e.IMAGE="image",e.DELETED="deleted"}(o||(t.MESSAGE_TYPES=o={})),t.MessageSchema=new i.Schema({message:{type:String,require:!0},type:{type:String,default:()=>o.TEXT},createdBy:{type:s,required:!0,ref:a.UserBaseModel},seenBy:[r.SeenSchema]},{timestamps:!0})},6638:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OutstandingSchema=t.EOutstandingType=void 0;const i=n(1185),r=n(6820);var a;!function(e){e.TEACHER="teacher",e.DEPARTMENT="department",e.LAB="lab"}(a||(t.EOutstandingType=a={}));const o=new i.Schema({image:{type:String,required:!0},ref:{type:i.Schema.Types.ObjectId,required:!0},creator:{type:i.Schema.Types.ObjectId,ref:r.UserBaseModel},type:{type:String,required:!0}},{timestamps:!0});t.OutstandingSchema=o},9978:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RoomSchema=void 0;const r=i(n(1185));var a=r.default.Types.ObjectId;t.RoomSchema=new r.default.Schema({participants:[{type:a,required:!0}],initiator:{type:a,required:!0},name:String,room_type:{type:String,required:!0}},{timestamps:!0})},5355:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SeenSchema=void 0;const i=n(1185);var r=i.Schema.Types.ObjectId;t.SeenSchema=new i.Schema({uid:{type:r,required:!0,ref:"User"},readAt:{type:Date,default:new Date}},{timestamps:!1})},4315:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=n(1185),r=new i.Schema({name:{type:String,required:!0},user:{type:i.Schema.Types.ObjectId,required:!0},department:{type:i.Schema.Types.ObjectId,required:!0},creator:{type:i.Schema.Types.ObjectId,required:!0}},{timestamps:!0});t.default=r},1868:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.TeacherSchema=void 0;const r=n(1185),a=n(6304),o=n(4919),s=i(n(3464)),c=n(1217),d=n(6479),u=new r.Schema({department:{type:r.Schema.Types.ObjectId,ref:d.DepartmentBaseModel},lab:{type:r.Schema.Types.ObjectId,ref:c.LabBaseModel},name:{type:String,required:!0,es_indexed:!0},description:{type:String},awards:{type:[r.Schema.Types.ObjectId]},contact:{type:a.ContactSchema},details:{type:[o.DetailSchema]},image:{type:String},creator:{type:r.Schema.Types.ObjectId,required:!0},user:{type:r.Schema.Types.ObjectId,required:!0}});t.TeacherSchema=u,u.plugin(s.default)},9372:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,a){function o(e){try{c(i.next(e))}catch(e){a(e)}}function s(e){try{c(i.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.setTokenIndex=t.schema=void 0;const r=n(9818),a=n(7773);t.schema={"$.token":{type:a.SchemaFieldTypes.TEXT,AS:"token"},"$.uid":{type:a.SchemaFieldTypes.TEXT,AS:"uid"}},t.setTokenIndex=function(){return i(this,void 0,void 0,(function*(){try{yield r.redis.ft.create("idx:token",t.schema,{ON:"JSON",PREFIX:"token_"})}catch(e){"Index already exists"===e.message?console.log("Index idx:token exists already, skipped creation."):console.error(e)}}))}},5102:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=n(1185),r=n(9125),a=new i.Schema({username:{type:String,required:!0,unique:!0,index:!0},password:{type:String,required:!0},role:{type:String,required:!0},version:{type:Number,required:!0},email:{type:String,unique:!0,index:!0},creator:{type:i.Schema.Types.ObjectId},name:{type:String,required:!0},favorites:{type:[r.FavoriteSchema],required:!0}});t.default=a},7315:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,a){function o(e){try{c(i.next(e))}catch(e){a(e)}}function s(e){try{c(i.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=n(1778);t.default=class{static create(e){return i(this,void 0,void 0,(function*(){const{name:t,user:n,department:i,creator:a}=e;return(yield r.StudentBaseModel.create({name:t,user:n,department:i,creator:a}))._id.toString()}))}static delete(e){return i(this,void 0,void 0,(function*(){return(yield r.StudentBaseModel.deleteOne({user:e}).exec()).acknowledged}))}static update(e,t){return i(this,void 0,void 0,(function*(){const{name:n,user:i,department:a}=t;return(yield r.StudentBaseModel.updateOne({user:e},{name:n,user:i,department:a})).acknowledged}))}static get(e){return i(this,void 0,void 0,(function*(){return yield r.StudentBaseModel.find({user:{$in:e}}).exec()}))}}},9660:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,a){function o(e){try{c(i.next(e))}catch(e){a(e)}}function s(e){try{c(i.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=n(18);t.default=class{static create(e){return i(this,void 0,void 0,(function*(){const{name:t,lab:n,department:i,description:a,awards:o,details:s,contact:c,image:d,creator:u,user:l}=e;return(yield r.TeacherBaseModel.create({name:t,lab:n,department:i,description:a,awards:o,details:s,contact:c,image:d,creator:u,user:l}))._id.toString()}))}static delete(e){return i(this,void 0,void 0,(function*(){return(yield r.TeacherBaseModel.deleteOne({user:e}).exec()).acknowledged}))}static update(e,t){return i(this,void 0,void 0,(function*(){const{department:n,lab:i,description:a,details:o,contact:s,image:c}=t;return(yield r.TeacherBaseModel.updateOne({user:e},{department:n,lab:i,description:a,details:o,contact:s,image:c})).acknowledged}))}static search(e){return i(this,void 0,void 0,(function*(){return(yield r.TeacherBaseModel.search({match:{name:{query:e,fuzziness:"auto",fuzzy_transpositions:!0}}},{hydrate:!0,hydrateOptions:{select:"name _id"}})).body.hits.hydrated}))}static get(e){return i(this,void 0,void 0,(function*(){return yield r.TeacherBaseModel.find({user:{$in:e}}).exec()}))}}},4947:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,a){function o(e){try{c(i.next(e))}catch(e){a(e)}}function s(e){try{c(i.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=n(9818),a=n(4816);t.default=new class{insertRefreshToken(e,t,n){return i(this,void 0,void 0,(function*(){if(yield r.redis.set((0,a.getKey)(t,a.NameType.USER_VERSION),0,{NX:!0}),"OK"!==(yield r.redis.json.set((0,a.getKey)(e,a.NameType.TOKEN),"$",{uid:t,token:e}))||"OK"!==(yield r.redis.set((0,a.getKey)(t,a.NameType.USER_ROLE),n)))throw new Error("Unable to add refresh token")}))}getRefreshToken(e){return i(this,void 0,void 0,(function*(){return yield r.redis.json.get((0,a.getKey)(e,a.NameType.TOKEN))}))}deleteRefreshToken(e){return i(this,void 0,void 0,(function*(){const t=yield r.redis.ft.search("idx:token",`@uid:"${e}"`);t&&(yield Promise.all(t.documents.map((e=>r.redis.json.del(e.id)))))}))}updateVersion(e){return i(this,void 0,void 0,(function*(){if(!r.redis.incr((0,a.getKey)(e,a.NameType.USER_VERSION)))throw new Error("Unable to update version")}))}getVersion(e){return i(this,void 0,void 0,(function*(){return yield r.redis.get((0,a.getKey)(e,a.NameType.USER_VERSION))}))}getRole(e){return i(this,void 0,void 0,(function*(){return yield r.redis.get((0,a.getKey)(e,a.NameType.USER_ROLE))}))}}},5805:function(e,t,n){var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,r)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return r(t,e),t},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,a){function o(e){try{c(i.next(e))}catch(e){a(e)}}function s(e){try{c(i.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const s=n(6820),c=a(n(8432));t.default=class{static validateUID(e){return o(this,void 0,void 0,(function*(){const t=Array.from(new Set(e)),n=(yield s.UserBaseModel.find({_id:{$in:t}},{_id:1}).exec()).map((e=>e._id.toString()));return t.every((e=>n.includes(e)))}))}static getUsers(e){return o(this,void 0,void 0,(function*(){const t=yield s.UserBaseModel.find({_id:{$in:e}},{email:!0,username:!0,_id:!0,role:1,name:1}).exec();if(t)return t.map((e=>{const{username:t,_id:n,email:i,role:r}=e;return{username:t,uid:n,email:i,role:r}}))}))}static create(e,t){return o(this,void 0,void 0,(function*(){const{username:n,role:i,name:r}=t;return(yield s.UserBaseModel.create({username:n,role:i,creator:e,name:r,version:0,favorites:[],email:n+"@vnu.edu.vn",password:yield c.hash("123456789",10)}))._id.toString()}))}static delete(e){return o(this,void 0,void 0,(function*(){return(yield s.UserBaseModel.deleteOne({_id:e})).acknowledged}))}static addFavorite(e,t){return o(this,void 0,void 0,(function*(){return(yield s.UserBaseModel.updateOne({_id:e},{$push:{favorites:{name:t.name,ref:t.ref,type:t.type}}})).acknowledged}))}static getFavourites(e){return o(this,void 0,void 0,(function*(){const t=yield s.UserBaseModel.findOne({_id:e},{favorites:1}).exec();return t?t.favorites:[]}))}}},8479:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=i(n(8961));t.default=function(e){e.use("/v1",r.default)}},9413:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=i(n(6860)),a=i(n(6464)),o=n(322),s=n(944),c=r.default.Router();c.post("/login",a.default.login),c.post("/logout",[o.checkJWT],a.default.logout),c.post("/create",[o.checkJWT,s.checkRole.bind({role:["admin"]})],a.default.create),c.delete("/:id",[o.checkJWT],s.checkRole.bind({role:["admin"]}),a.default.delete),t.default=c},9171:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=i(n(8665)),a=i(n(6319)),o=n(322),s=(0,n(6860).Router)();s.post("/room",[o.checkJWT],r.default.createRoom),s.put("/room/:roomID",[o.checkJWT],r.default.updateRoomName),s.delete("/room/:roomID",[o.checkJWT],r.default.deleteRoom),s.post("/msg",[o.checkJWT],a.default.createMessage),t.default=s},2669:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=i(n(7022)),a=n(322),o=n(944),s=(0,n(6860).Router)();s.post("/",[a.checkJWT,o.checkRole.bind({role:["admin"]})],r.default.create),s.delete("/:id",[a.checkJWT,o.checkRole.bind({role:["admin"]})],r.default.delete),s.post("/:id/comment",[a.checkJWT],r.default.addComment),s.delete("/:id/comment/:cid",[a.checkJWT],r.default.deleteComment),t.default=s},4408:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=i(n(8964)),a=n(322),o=n(944),s=(0,n(6860).Router)();s.post("/",[a.checkJWT,o.checkRole.bind({role:["admin"]})],r.default.create),s.delete("/:id",[a.checkJWT,o.checkRole.bind({role:["admin"]})],r.default.delete),t.default=s},8961:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(6860),a=i(n(9413)),o=i(n(9171)),s=i(n(8114)),c=i(n(4408)),d=i(n(6785)),u=i(n(7471)),l=i(n(496)),f=i(n(2669)),h=(0,r.Router)();h.use("/chat",o.default),h.use("/auth",a.default),h.use("/outstanding",s.default),h.use("/department",c.default),h.use("/lab",d.default),h.use("/search",u.default),h.use("/class",f.default),h.use("/me",l.default),t.default=h},6785:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=i(n(1329)),a=n(322),o=n(944),s=(0,n(6860).Router)();s.post("/",[a.checkJWT,o.checkRole.bind({role:["admin"]})],r.default.create),s.delete("/:id",[a.checkJWT,o.checkRole.bind({role:["admin"]})],r.default.delete),t.default=s},496:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=i(n(4107)),a=n(322),o=(0,n(6860).Router)();o.get("/",[a.checkJWT],r.default.getProfile),o.get("/favourite",[a.checkJWT],r.default.getFavorite),o.post("/favourite",[a.checkJWT],r.default.addFavorite),t.default=o},8114:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=i(n(4340)),a=n(322),o=n(944),s=(0,n(6860).Router)();s.post("/",[a.checkJWT,o.checkRole.bind({role:["admin"]})],r.default.create),s.delete("/:id",[a.checkJWT,o.checkRole.bind({role:["admin"]})],r.default.delete),t.default=s},7471:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=i(n(7782)),a=n(322),o=(0,n(6860).Router)();o.get("/",[a.checkJWT],r.default.search),t.default=o},2790:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.EUserRole=void 0,function(e){e.ADMIN="admin",e.TEACHER="teacher",e.STUDENT="student"}(n||(t.EUserRole=n={}))},5417:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.InputError=void 0;class n extends Error{constructor(e,t){super(e),Object.setPrototypeOf(this,n.prototype),this.field=t}}t.InputError=n},7797:function(e,t,n){var i=this&&this.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.generate_password=t.generateResetToken=t.generateToken=t.generate_uid=void 0;const a=n(9344),o=r(n(5343)),s=n(1633);function c(e,t){return Math.floor(Math.random()*(t-e))+e}t.generate_uid=function(e=8){return e=e>0?e:8,[...new Array(e)].map((()=>c(0,9).toString())).join("")},t.generateToken=function(e,t){const n=e,{iat:r,exp:c}=n,d=i(n,["iat","exp"]);return{accessToken:(0,a.sign)(d,o.default.JWT_KEY,s.JWTTokenOpt),refreshToken:t&&(0,a.sign)(d,o.default.JWT_REFRESH_KEY,s.JWTRefreshOpt)}},t.generateResetToken=function(e){const t=e,{iat:n,exp:r}=t,c=i(t,["iat","exp"]);return(0,a.sign)(c,o.default.JWT_RESET_KEY,s.JWTResetOpt)},t.generate_password=function(e=8){e=e>0?e:8;return[...new Array(e)].map((()=>"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890"[c(0,61)])).join("")}},9412:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,a){function o(e){try{c(i.next(e))}catch(e){a(e)}}function s(e){try{c(i.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=n(5417);t.default=function(e,t){return i(this,void 0,void 0,(function*(){try{yield t()}catch(t){console.log(t),t instanceof r.InputError?e.status(400).json({message:t.message,name:t.field}):e.sendStatus(500)}}))}},4816:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.getKey=t.NameType=void 0,function(e){e[e.USER_VERSION=0]="USER_VERSION",e[e.USER_ROLE=1]="USER_ROLE",e[e.TOKEN=2]="TOKEN"}(n||(t.NameType=n={})),t.getKey=function(e,t){return t===n.USER_VERSION&&e+"_v"||t===n.USER_ROLE&&e+"_r"||t===n.TOKEN&&"token_"+e||e}},4747:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(5417),a=i(n(3389));class o extends a.default{static checkUsername(e,t){if(e){if(e.length<3||e.length>50)throw new r.InputError("Username có độ dài từ 3 đến 50 ký tự","username")}else if(!t)throw new r.InputError("Must include username","username")}static checkPassword(e){if(!e||e.length<8||e.length>50)throw new r.InputError("Mật khẩu có độ dài từ 8 đến 50 ký tự","password")}static validateLogin(e){this.checkUsername(e.username),this.checkPassword(e.password)}}t.default=o},3389:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=n(2790),r=n(5417);t.default=class{static checkName(e,t){if(e){if(!e||e.length<5)throw new r.InputError("Invalid name","name")}else if(!t)throw new r.InputError("Must include name","name")}static checkFile(e,t){if(e);else if(!t)throw new r.InputError("Must include a file","file")}static checkId(e,t){if(e){if(24!=e.length)throw new r.InputError("Invalid id","id")}else if(!t)throw new r.InputError("Must include id","id")}static checkEmail(e,t){if(e){if(!/^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/.test(e))throw new r.InputError("Email không hợp lệ","email")}else if(!t)throw new r.InputError("Must include email","email")}static checkRole(e,t){if(e){if(!Object.values(i.EUserRole).includes(e))throw new r.InputError("Invalid role","role")}else if(!t)throw new r.InputError("Must include role","role")}static checkPhone(e,t){if(e){if(10!==e.length||!e.startsWith("0"))throw new r.InputError("Invalid phone number","phone")}else if(!t)throw new r.InputError("Must include phone number","phone")}static checkLink(e,t){if(e){if(!/[(http(s)?):\/\/(www\.)?a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/.test(e))throw new r.InputError("Link không hợp lệ","link")}else if(!t)throw new r.InputError("Must include link","link")}static checkContact(e,t){if(e){if(!e.phones||!Array.isArray(e.phones))throw new r.InputError("Contact phones must be an array","contact.phones");if(!e.emails||!Array.isArray(e.emails))throw new r.InputError("Contact emails must be an array","contact.emails");if(e.social&&!Array.isArray(e.social))throw new r.InputError("Contact social must be an array","contact.social");e.phones.forEach((e=>this.checkPhone(e))),e.emails.forEach((e=>this.checkEmail(e))),e.social&&e.social.forEach((e=>this.checkLink(e)))}else if(!t)throw new r.InputError("Must include contact","contact")}static checkDetail(e,t){if(e){if(!Array.isArray(e))throw new r.InputError("Detail must be an array","detail");e.forEach((e=>{if(this.checkName(e.title),!Array.isArray(e.content))throw new r.InputError("Detail content must be an array","detail.content");e.content.forEach((e=>this.checkName(e)))}))}else if(!t)throw new r.InputError("Must include details","details")}}},4216:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=n(2045),r=n(5417);t.default=new class{validateRoomID(e){if(!e)throw new r.InputError("Must provide roomID","participants");return!0}validateCreateRoom(e){if(!e.participants)throw new r.InputError("Must provide participants","participants");if(!Array.isArray(e.participants))throw new r.InputError("Participants must be an array","participants")}validateDeleteRoom(e){this.validateRoomID(e.roomID)}validateGetRoom(e){this.validateRoomID(e.roomID)}validateUpdateRoom(e){this.validateRoomID(e.roomID)}validateCreateMessage(e){if(this.validateRoomID(e.roomID),!Object.values(i.MESSAGE_TYPES).includes(e.type))throw new Error("Invalid message type",{cause:"type"})}}},3211:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(5417),a=i(n(3389));class o extends a.default{static checkStudent(e,t){if(e){if(!Array.isArray(e))throw new r.InputError("students must be an array","students");e.forEach((e=>this.checkId(e)))}else if(!t)throw new r.InputError("Must include students list","students")}static checkClassID(e,t){if(e);else if(!t)throw new r.InputError("Must include class ID","classID")}static validateCreate(e){this.checkName(e.name),this.checkId(e.teacher),this.checkClassID(e.classID),this.checkStudent(e.students)}static validateDelete(e){this.checkId(e.id)}}t.default=o},4003:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=i(n(3389));class a extends r.default{static validateCreate(e){this.checkId(e.id),this.checkName(e.content)}static validateDelete(e){this.checkId(e.id),this.checkId(e.cid)}}t.default=a},9416:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=i(n(3389));class a extends r.default{static validateCreate(e){this.checkName(e.name),this.checkId(e.dean),this.checkFile(e.image),this.checkContact(e.contact),this.checkDetail(e.details)}static validateDelete(e){this.checkId(e.id)}}t.default=a},8937:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=i(n(3389));class a extends r.default{static validateCreate(e){this.checkName(e.name),this.checkId(e.dean),this.checkFile(e.image),this.checkContact(e.contact),this.checkDetail(e.details),this.checkId(e.department)}static validateDelete(e){this.checkId(e.id)}}t.default=a},1529:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=i(n(3389)),a=n(9125),o=n(5417);class s extends r.default{static checkFavouriteType(e,t){if(e){if(!Object.values(a.EFavouriteType).includes(e))throw new o.InputError("Invalid favourite type","type")}else if(!t)throw new o.InputError("Must include favorite type","type")}static validateAddFavourite(e){this.checkId(e.ref),this.checkFavouriteType(e.type),this.checkName(e.name)}}t.default=s},4539:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(5417),a=i(n(3389)),o=n(6638);class s extends a.default{static checkOutstandingType(e,t){if(e){if(!Object.values(o.EOutstandingType).includes(e))throw new r.InputError("Invalid outstanding type","type")}else if(!t)throw new r.InputError("Must included outstanding type","type")}static validateCreate(e){this.checkFile(e.image),this.checkId(e.ref),this.checkOutstandingType(e.type)}static validateDelete(e){this.checkId(e.id)}}t.default=s},8047:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=i(n(3389));class a extends r.default{static validateCreate(e){this.checkId(e.user),this.checkId(e.department),this.checkName(e.name)}static validateUpdate(e){}static validateDelete(e){this.checkId(e.id)}}t.default=a},7649:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(5417),a=i(n(3389));class o extends a.default{static checkAwards(e,t){if(e){if(!Array.isArray(e))throw new r.InputError("Awards must be an array","awards");e.forEach((e=>this.checkId(e)))}else if(!t)throw new r.InputError("Must include a list of awards","awards")}static validateCreate(e){this.checkName(e.name),this.checkId(e.user),this.checkId(e.lab,!0),this.checkId(e.department,!0),this.checkAwards(e.awards,!0),this.checkContact(e.contact,!0),this.checkDetail(e.details,!0),this.checkFile(e.image,!0)}static validateUpdate(e){this.checkId(e.id),this.checkId(e.lab,!0),this.checkId(e.department,!0),this.checkContact(e.contact,!0),this.checkDetail(e.details,!0),this.checkFile(e.image,!0)}static validateDelete(e){this.checkId(e.id)}}t.default=o},203:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(5417),a=i(n(3389));class o extends a.default{static checkUsername(e,t){if(e){if(e.length<3||e.length>50)throw new r.InputError("Username có độ dài từ 3 đến 50 ký tự","username")}else if(!t)throw new r.InputError("Must include username","username")}static validateCreate(e){this.checkName(e.name),this.checkUsername(e.username),this.checkRole(e.role)}static validateDelete(e){this.checkId(e.id)}}t.default=o},8432:e=>{e.exports=require("bcryptjs")},3518:e=>{e.exports=require("cloudinary")},9710:e=>{e.exports=require("cookie-parser")},3582:e=>{e.exports=require("cors")},5142:e=>{e.exports=require("dotenv")},6860:e=>{e.exports=require("express")},6674:e=>{e.exports=require("express-fileupload")},7806:e=>{e.exports=require("helmet")},9344:e=>{e.exports=require("jsonwebtoken")},3464:e=>{e.exports=require("mongoosastic")},1185:e=>{e.exports=require("mongoose")},9470:e=>{e.exports=require("morgan")},7773:e=>{e.exports=require("redis")},3952:e=>{e.exports=require("socket.io")},8849:e=>{e.exports=require("node:http")},1017:e=>{e.exports=require("path")}},t={};function n(i){var r=t[i];if(void 0!==r)return r.exports;var a=t[i]={id:i,loaded:!1,exports:{}};return e[i].call(a.exports,a,a.exports,n),a.loaded=!0,a.exports}n.c=t,n.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),n(n.s=3607)})();