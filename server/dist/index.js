(()=>{"use strict";var e={3114:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=n(3518),o=i(n(5343)),{CLOUDINARY_CLOUD_NAME:r,CLOUDINARY_API_KEY:s,CLOUDINARY_API_SECRET:c}=o.default;a.v2.config({cloud_name:r,api_key:s,api_secret:c}),t.default=a.v2},4742:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.withAge=t.cookieSecureOption=void 0,t.cookieSecureOption={httpOnly:!1,secure:!1},t.withAge=function(e){return Object.assign(Object.assign({},t.cookieSecureOption),{maxAge:e})}},2009:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function r(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}c((i=i.apply(e,t||[])).next())}))},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.connect=void 0;const o=a(n(1185)),r=a(n(5343)),{MG_HOST:s,MG_NAME:c,MG_USERNAME:d,MG_PASSWORD:u,MONGODB_URI:l}=r.default;o.default.set("strictQuery",!0);const f=l||`mongodb+srv://${d}:${u}@${s}/${c}?retryWrites=true&w=majority`;t.connect=()=>i(void 0,void 0,void 0,(function*(){return o.default.connect(f)}))},5343:function(e,t,n){var i=this&&this.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(n[i[a]]=e[i[a]])}return n},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.env=void 0;const o=n(5142),r=a(n(1017)),s=process.env,{NODE_ENV:c}=s,d=i(s,["NODE_ENV"])||{},u=(0,o.config)("dev"===c?{path:r.default.resolve(process.cwd(),".env.dev")}:void 0).parsed,l=Object.assign(Object.assign(Object.assign({},u),{ENV:"production"}),d);t.env="production",t.default=l},1633:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.JWTChatOpt=t.JWTResetOpt=t.JWTRefreshOpt=t.JWTTokenOpt=void 0;const a=i(n(5343));t.JWTTokenOpt={expiresIn:"dev"===a.default.ENV?"10s":"3600s"},t.JWTRefreshOpt={expiresIn:"dev"===a.default.ENV?"3600s":"86400s"},t.JWTResetOpt={expiresIn:"dev"===a.default.ENV?"180s":"300s"},t.JWTChatOpt={expiresIn:"dev"===a.default.ENV?"3600s":"86400s"}},9818:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function r(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}c((i=i.apply(e,t||[])).next())}))},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.startup=t.setupRedisIndex=t.redis=void 0;const o=n(7773),r=a(n(5343)),s=n(9372);function c(){return i(this,void 0,void 0,(function*(){yield(0,s.setTokenIndex)()}))}t.redis=(0,o.createClient)({password:r.default.RD_PASSWORD,socket:{host:r.default.RD_HOST,port:Number(r.default.RD_PORT)}}),t.setupRedisIndex=c,t.startup=function(){return i(this,void 0,void 0,(function*(){yield t.redis.connect(),yield c()}))}},6464:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function r(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}c((i=i.apply(e,t||[])).next())}))},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=n(5417),r=n(2790),s=n(4742),c=n(7797),d=a(n(9412)),u=a(n(5215)),l=a(n(4947)),f=a(n(9660)),h=a(n(7315)),p=a(n(5805)),v=a(n(7148)),m=a(n(4747)),y=a(n(8047)),_=a(n(7649)),g=a(n(203));class w{static precheck(e){return i(this,void 0,void 0,(function*(){if(e.department&&0===(yield v.default.get([e.department])).length)throw new o.InputError("Invalid department id","department")}))}static login(e,t){return i(this,void 0,void 0,(function*(){const n=e.body;console.log(n),yield(0,d.default)(t,(()=>i(this,void 0,void 0,(function*(){m.default.validateLogin(n);const e=yield u.default.findUserByPassword(n.username,n.password);if(e){const i=(yield l.default.getVersion(e.uid))||"0",a=(0,c.generateToken)(Object.assign(Object.assign({},e),{version:i,remember:n.remember}),!0);yield l.default.insertRefreshToken(a.refreshToken,e.uid,e.role),function(e,t,n,i){i&&e.cookie("refresh_token",i,(0,s.withAge)(864e5)),e.status(200).cookie("token",n,(0,s.withAge)(t?36e5:void 0)).json({message:"success",data:{accessToken:n,refreshToken:i}}).send()}(t,n.remember,a.accessToken,a.refreshToken)}else t.status(401).json({message:"Invalid username or password",name:"password"})}))))}))}static logout(e,t){return i(this,void 0,void 0,(function*(){const e=t.locals.user;yield(0,d.default)(t,(()=>i(this,void 0,void 0,(function*(){l.default.deleteRefreshToken(e.uid),l.default.updateVersion(e.uid),t.cookie("token",null,(0,s.withAge)(0)),t.cookie("refresh_token",null,(0,s.withAge)(0)),t.sendStatus(200)}))))}))}static create(e,t){return i(this,void 0,void 0,(function*(){const n=e.body,a=t.locals.user;(0,d.default)(t,(()=>i(this,void 0,void 0,(function*(){g.default.validateCreate(n),yield w.precheck(n);const{creator:e,name:i,username:o,role:s,department:c}=Object.assign(Object.assign({},n),{creator:a.uid}),d=yield p.default.create({name:i,username:o,role:s,creator:e});var u=null;n.role===r.EUserRole.STUDENT?(y.default.validateCreate(Object.assign(Object.assign({},n),{user:d})),u=yield h.default.create({creator:e,name:i,department:c,user:d})):n.role===r.EUserRole.TEACHER&&(_.default.validateCreate(Object.assign(Object.assign({},n),{user:d})),u=yield f.default.create({creator:e,name:i,department:c,user:d})),t.json({message:"Created successfully",data:{id:d,password:"123456789",role:n.role,profile_id:u}})}))))}))}static delete(e,t){return i(this,void 0,void 0,(function*(){const n=e.params.id;(0,d.default)(t,(()=>i(this,void 0,void 0,(function*(){g.default.validateDelete({id:n});const e=yield p.default.delete(n),i=(yield f.default.delete(n))&&(yield h.default.delete(n));t.status(200).json({message:e&&i?"Delete successfully":"Unable to delete",data:{id:n}})}))))}))}}t.default=w},6319:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function r(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}c((i=i.apply(e,t||[])).next())}))},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MessageChatController=void 0;const o=a(n(5343)),r=n(1633),s=n(6815),c=a(n(9412)),d=n(4216),u=n(9344);t.MessageChatController=class{static createMessage(e,t){return i(this,void 0,void 0,(function*(){const n=t.locals.user,a=e.params.roomID,o=e.body;(0,c.default)(t,(()=>i(this,void 0,void 0,(function*(){d.ChatValidator.validateCreateMessage(Object.assign(Object.assign({},o),{roomID:a}));const e=yield s.MessageModel.createMessage(a,n.uid,o.message,o.type);t.json({message:"success",data:{mid:e}})}))))}))}static generateChatToken(e,t){return i(this,void 0,void 0,(function*(){const{name:e,uid:n}=t.locals.user;(0,c.default)(t,(()=>i(this,void 0,void 0,(function*(){const i=(0,u.sign)({name:e,uid:n},o.default.JWT_CHAT,r.JWTChatOpt);t.status(200).json({message:"success",data:{token:i}})}))))}))}}},7022:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function r(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}c((i=i.apply(e,t||[])).next())}))},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=n(5417),r=a(n(9412)),s=a(n(3211)),c=a(n(4003)),d=a(n(2237)),u=a(n(7315)),l=a(n(9660)),f=a(n(827));class h{static precheck(e){return i(this,void 0,void 0,(function*(){if(e.students&&(yield u.default.get(e.students)).length!=e.students.length)throw new o.InputError("Invalid students ref","students");if(e.teacher&&0===(yield l.default.get([e.teacher])).length)throw new o.InputError("Invalid teachers ref","teachers")}))}static create(e,t){return i(this,void 0,void 0,(function*(){const n=t.locals.user,a=e.body;(0,r.default)(t,(()=>i(this,void 0,void 0,(function*(){s.default.validateCreate(a),yield h.precheck(a);const e=yield d.default.create({classID:a.classID,creator:n.uid,description:a.description,name:a.name,students:a.students,teacher:a.teacher});yield l.default.addClass(a.teacher,e),yield u.default.addClass(a.students,e),yield f.default.create(a.students,{classID:e,creator:n.uid}),t.status(200).json({message:"Created successfully",data:{id:e}})}))))}))}static delete(e,t){return i(this,void 0,void 0,(function*(){const n=e.params.id;(0,r.default)(t,(()=>i(this,void 0,void 0,(function*(){s.default.validateDelete({id:n});const{students:e,teacher:i}=(yield d.default.get([n]))[0],a=yield d.default.delete(n);yield u.default.deleteClass(e.map((e=>e.toString())),n),yield l.default.deleteClass(i.toString(),n),yield f.default.delete(e.map((e=>e.toString())),n),t.status(200).send({message:a?"Deleted successfully":"Unable to delete",data:{id:n}})}))))}))}static addComment(e,t){return i(this,void 0,void 0,(function*(){const n=e.params.id,a=t.locals.user,o=e.body;(0,r.default)(t,(()=>i(this,void 0,void 0,(function*(){c.default.validateCreate(Object.assign(Object.assign({},o),{id:n}));const e=yield d.default.addComment(n,{creator:a.uid,content:o.content});t.status(200).json({message:e?"Created comment successfully":"Unable to create comment"})}))))}))}static deleteComment(e,t){return i(this,void 0,void 0,(function*(){const{id:n,cid:a}=e.params,o=t.locals.user;(0,r.default)(t,(()=>i(this,void 0,void 0,(function*(){c.default.validateDelete({id:n,cid:a});const e=yield d.default.deleteComment(n,{creator:o.uid,cid:a});t.status(200).json({message:e?"Deleted comment successfully":"Unable to delete comment"})}))))}))}}t.default=h},8964:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function r(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}c((i=i.apply(e,t||[])).next())}))},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=n(5417),r=a(n(9412)),s=a(n(3114)),c=a(n(9416)),d=a(n(5805)),u=n(2790),l=a(n(7148));class f{static precheck(e){return i(this,void 0,void 0,(function*(){if(e.dean){const t=yield d.default.getUsers([e.dean]);if(0===t.length)throw new o.InputError("Invalid dean id","dean");if(t[0].role!==u.EUserRole.TEACHER)throw new o.InputError("Invalid role of dean","dean")}}))}static create(e,t){return i(this,void 0,void 0,(function*(){const n=t.locals.user,a=e.body,o=e.files;(0,r.default)(t,(()=>i(this,void 0,void 0,(function*(){a.contact="string"==typeof a.contact?JSON.parse(a.contact):a.contact,a.details="string"==typeof a.details?JSON.parse(a.details):a.details,c.default.validateCreate(Object.assign(Object.assign({},a),{image:o?"true":void 0})),yield f.precheck(a);const e=o.image,i=yield s.default.uploader.upload(e.tempFilePath,{public_id:e.name,resource_type:"auto",folder:"uploaded",use_filename:!0,unique_filename:!1});if(i.secure_url){const e=yield l.default.create({image:i.secure_url,dean:a.dean,contact:a.contact,name:a.name,description:a.description,details:a.details,creator:n.uid});t.status(200).send({message:"Success",data:{id:e}})}else t.status(500).send({message:"Unable to upload image"})}))))}))}static delete(e,t){return i(this,void 0,void 0,(function*(){const n=e.params.id;(0,r.default)(t,(()=>i(this,void 0,void 0,(function*(){c.default.validateDelete({id:n});const e=yield l.default.delete(n);t.status(200).send({message:e?"Deleted successfully":"Unable to delete",data:{id:n}})}))))}))}static getAllDepartmentsName(e,t){return i(this,void 0,void 0,(function*(){(0,r.default)(t,(()=>i(this,void 0,void 0,(function*(){const e=yield l.default.getAllName();t.status(200).json({message:"success",data:{departments:e}})}))))}))}}t.default=f},5409:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function r(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}c((i=i.apply(e,t||[])).next())}))},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=a(n(2237)),r=a(n(827)),s=n(5417),c=a(n(9412)),d=a(n(8103));class u{static precheck(e){return i(this,void 0,void 0,(function*(){if(e.classID&&0===(yield o.default.get([e.classID])).length)throw new s.InputError("Invalid classID update","classID")}))}static update(e,t){return i(this,void 0,void 0,(function*(){const n=t.locals.user,a=e.params.clid,o=e.body;(0,c.default)(t,(()=>i(this,void 0,void 0,(function*(){d.default.validateUpdate(Object.assign(Object.assign({},o),{classID:a})),yield u.precheck(Object.assign(Object.assign({},o),{classID:a})),yield r.default.update({classID:a,participant:n.uid,criteria:o.criteria}),t.status(200).json({message:"success"})}))))}))}}t.default=u},1329:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function r(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}c((i=i.apply(e,t||[])).next())}))},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=n(5417),r=a(n(9412)),s=a(n(3114)),c=a(n(5805)),d=n(2790),u=a(n(7148)),l=a(n(8937)),f=a(n(608));class h{static precheck(e){return i(this,void 0,void 0,(function*(){if(e.dean){const t=yield c.default.getUsers([e.dean]);if(0===t.length)throw new o.InputError("Invalid dean id","dean");if(t[0].role!==d.EUserRole.TEACHER)throw new o.InputError("Invalid role of dean","dean")}if(e.department&&0===(yield u.default.get([e.department])).length)throw new o.InputError("Invalid department id","department")}))}static create(e,t){return i(this,void 0,void 0,(function*(){const n=t.locals.user,a=e.body,o=e.files;(0,r.default)(t,(()=>i(this,void 0,void 0,(function*(){a.contact="string"==typeof a.contact?JSON.parse(a.contact):a.contact,a.details="string"==typeof a.details?JSON.parse(a.details):a.details,l.default.validateCreate(Object.assign(Object.assign({},a),{image:o?"true":void 0})),yield h.precheck(a);const e=o.image,i=yield s.default.uploader.upload(e.tempFilePath,{public_id:e.name,resource_type:"auto",folder:"uploaded",use_filename:!0,unique_filename:!1});if(i.secure_url){const e=yield f.default.create({image:i.secure_url,dean:a.dean,contact:a.contact,name:a.name,description:a.description,details:a.details,creator:n.uid,department:a.department});t.status(200).send({message:"Success",data:{id:e}})}else t.status(500).send({message:"Unable to upload image"})}))))}))}static delete(e,t){return i(this,void 0,void 0,(function*(){const n=e.params.id;(0,r.default)(t,(()=>i(this,void 0,void 0,(function*(){l.default.validateDelete({id:n});const e=yield f.default.delete(n);t.status(200).send({message:e?"Deleted successfully":"Unable to delete",data:{id:n}})}))))}))}}t.default=h},4107:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function r(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}c((i=i.apply(e,t||[])).next())}))},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=a(n(7148)),r=a(n(608)),s=n(9125),c=a(n(9660)),d=a(n(5805)),u=n(5417),l=a(n(9412)),f=a(n(1529));class h{static checkValidFavouriteRef(e){return i(this,void 0,void 0,(function*(){switch(e.type){case s.EFavouriteType.TEACHER:if(0===(yield c.default.get([e.ref])).length)throw new u.InputError("Invalid ref id","ref");break;case s.EFavouriteType.DEPARTMENT:if(0===(yield o.default.get([e.ref])).length)throw new u.InputError("Invalid ref id","ref");break;case s.EFavouriteType.LAB:if(0===(yield r.default.get([e.ref])).length)throw new u.InputError("Invalid ref id","ref")}}))}static getProfile(e,t){return i(this,void 0,void 0,(function*(){const e=t.locals.user;(0,l.default)(t,(()=>i(this,void 0,void 0,(function*(){t.status(200).json({message:"successfully",data:{role:e.role,username:e.username,name:e.name,uid:e.uid}})}))))}))}static addFavorite(e,t){return i(this,void 0,void 0,(function*(){const n=t.locals.user,a=e.body;(0,l.default)(t,(()=>i(this,void 0,void 0,(function*(){console.log(a),f.default.validateAddFavourite(a),yield h.checkValidFavouriteRef(a);const e=d.default.addFavorite(n.uid,a);t.json({message:e?"Added successfully":"Unable to add"})}))))}))}static getFavorite(e,t){return i(this,void 0,void 0,(function*(){const e=t.locals.user;(0,l.default)(t,(()=>i(this,void 0,void 0,(function*(){const n=yield d.default.getFavourites(e.uid);t.status(200).json({message:"success",data:{favorites:n}})}))))}))}}t.default=h},4340:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function r(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}c((i=i.apply(e,t||[])).next())}))},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=a(n(8101)),r=n(5417),s=a(n(9412)),c=a(n(4539)),d=a(n(3114)),u=n(6638),l=a(n(5805)),f=n(2790),h=a(n(7148)),p=a(n(608)),v=a(n(9660));class m{static precheck(e){return i(this,void 0,void 0,(function*(){switch(e.type){case u.EOutstandingType.TEACHER:const t=yield l.default.getUsers([e.ref]);if(0===t.length)throw new r.InputError("Invalid ref id","ref");if(t[0].role!==f.EUserRole.TEACHER)throw new r.InputError("Invalid role ref","ref");break;case u.EOutstandingType.DEPARTMENT:if(0===(yield h.default.get([e.ref])).length)throw new r.InputError("Invalid ref id","ref");break;case u.EOutstandingType.LAB:if(0===(yield p.default.get([e.ref])).length)throw new r.InputError("Invalid ref id","ref")}}))}static create(e,t){return i(this,void 0,void 0,(function*(){const n=t.locals.user,a=e.body,r=e.files;(0,s.default)(t,(()=>i(this,void 0,void 0,(function*(){c.default.validateCreate(Object.assign(Object.assign({},a),{image:r?"true":void 0})),yield m.precheck(a);const e=r.image,i=yield d.default.uploader.upload(e.tempFilePath,{public_id:e.name,resource_type:"auto",folder:"uploaded",use_filename:!0,unique_filename:!1});if(i.secure_url){const e=yield o.default.create({image:i.secure_url,ref:a.ref,type:a.type,creator:n.uid});t.status(200).send({message:"Success",data:{id:e}})}else t.status(500).send({message:"Unable to upload image"})}))))}))}static delete(e,t){return i(this,void 0,void 0,(function*(){const n=e.params.id;(0,s.default)(t,(()=>i(this,void 0,void 0,(function*(){c.default.validateDelete({id:n});const e=yield o.default.delete(n);t.status(200).send({message:e?"Deleted successfully":"Unable to delete",data:{id:n}})}))))}))}static getAll(e,t){return i(this,void 0,void 0,(function*(){(0,s.default)(t,(()=>i(this,void 0,void 0,(function*(){const e=(yield o.default.getAll()).map((e=>e.ref.toString())),n=yield v.default.get(e);t.status(200).json({message:"success",data:{outstanding:n}})}))))}))}}t.default=m},8665:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function r(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}c((i=i.apply(e,t||[])).next())}))},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RoomController=void 0;const o=n(6815),r=a(n(6362)),s=a(n(5805)),c=n(5417),d=a(n(9412)),u=n(4216);class l{static checkUser(e){return i(this,void 0,void 0,(function*(){if(e&&0===(yield s.default.getUsers(e)).length)throw new c.InputError("Invalid user id","participants")}))}static createRoom(e,t){return i(this,void 0,void 0,(function*(){const n=t.locals.user,a=e.body;(0,d.default)(t,(()=>i(this,void 0,void 0,(function*(){u.ChatValidator.validateCreateRoom(a),yield l.checkUser(a.participants);const e=yield r.default.findByParticipants(a.participants);if(e)t.status(200).json({message:"The room has been created previously",data:{is_new:!1,room_id:e._id}});else{const e=yield r.default.createRoom(n.uid,a.participants,a.name);t.status(200).json({message:"The room has been created successfully",data:{is_new:!0,room_id:e._id}})}}))))}))}static deleteRoom(e,t){return i(this,void 0,void 0,(function*(){const n=t.locals.user,a=e.params.roomID;(0,d.default)(t,(()=>i(this,void 0,void 0,(function*(){u.ChatValidator.validateDeleteRoom({roomID:a}),(yield r.default.deleteRoom(a,n.uid))?t.status(200).json({message:"The room has been deleted successfully",data:{roomID:a}}):t.status(400).json({message:"You have not permission to delete this room",data:{roomID:a}})}))))}))}static getRoomByID(e,t){return i(this,void 0,void 0,(function*(){const n=t.locals.user,a=e.params.roomID;(0,d.default)(t,(()=>i(this,void 0,void 0,(function*(){u.ChatValidator.validateGetRoom({roomID:a});const e=yield r.default.getRoom(a,n.uid),i=e&&(yield o.MessageModel.getConversation(a));t.json({message:"success",data:{room:e,messages:i}})}))))}))}static getAllRooms(e,t){return i(this,void 0,void 0,(function*(){const e=t.locals.user;(0,d.default)(t,(()=>i(this,void 0,void 0,(function*(){const n=yield r.default.getAllRooms(e.uid);t.json({message:"success",data:n})}))))}))}static updateRoomName(e,t){return i(this,void 0,void 0,(function*(){const n=t.locals.user,{name:a}=e.body,o=e.params.roomID;(0,d.default)(t,(()=>i(this,void 0,void 0,(function*(){u.ChatValidator.validateUpdateRoom({roomID:o});const e=yield r.default.updateRoom(o,n.uid,a);t.json({message:"success",data:e})}))))}))}}t.RoomController=l},7782:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function r(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}c((i=i.apply(e,t||[])).next())}))},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=a(n(2237)),r=a(n(7148)),s=a(n(608)),c=a(n(9660)),d=a(n(9412));t.default=class{static search(e,t){return i(this,void 0,void 0,(function*(){const n=e.query;(0,d.default)(t,(()=>i(this,void 0,void 0,(function*(){const[e,i,a,d]=yield Promise.all([c.default.search(n.query),s.default.search(n.query),r.default.search(n.query),o.default.search(n.query)]);t.status(200).json({message:"success",data:{query:n.query,users:e,labs:i,departments:a,classes:d}})}))))}))}}},466:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function r(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}c((i=i.apply(e,t||[])).next())}))},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=n(5417),r=a(n(9412)),s=a(n(3114)),c=a(n(608)),d=a(n(9660)),u=a(n(7649)),l=a(n(5805));class f{static precheck(e){return i(this,void 0,void 0,(function*(){if(e.lab&&0===(yield c.default.get([e.lab])).length)throw new o.InputError("Invalid ref id","ref")}))}static update(e,t){return i(this,void 0,void 0,(function*(){const n=e.params.id,a=e.body,o=e.files;(0,r.default)(t,(()=>i(this,void 0,void 0,(function*(){a.contact="string"==typeof a.contact?JSON.parse(a.contact):a.contact,a.details="string"==typeof a.details?JSON.parse(a.details):a.details,u.default.validateUpdate(Object.assign(Object.assign({},a),{id:n,image:o?"true":void 0})),yield f.precheck(a);const e=o.image;if((yield s.default.uploader.upload(e.tempFilePath,{public_id:e.name,resource_type:"auto",folder:"uploaded",use_filename:!0,unique_filename:!1})).secure_url){const e=yield d.default.update(n,a);t.status(200).send({message:e?"Deleted successfully":"Unable to delete",data:{id:n}})}else t.status(200).send({message:"Unable to upload image"})}))))}))}static getAll(e,t){return i(this,void 0,void 0,(function*(){const e=t.locals.user;(0,r.default)(t,(()=>i(this,void 0,void 0,(function*(){const[n,i]=yield Promise.all([d.default.getAll(),l.default.getFavourites(e.uid)]);t.status(200).json({message:"success",data:{teacher:n.map((e=>Object.assign(Object.assign({},e),{liked:i.some((e=>e.ref))})))}})}))))}))}}t.default=f},3607:function(e,t,n){e=n.nmd(e);var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,a)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return a(t,e),t},r=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function r(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}c((i=i.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const c=s(n(6860)),d=s(n(7806)),u=s(n(9470)),l=s(n(6674)),f=s(n(9710)),h=n(3952),p=n(8849),v=s(n(8479)),m=s(n(5343)),y=o(n(2009)),_=o(n(9818)),g=n(322),w=n(5194),O=(0,c.default)(),b=m.default.PORT,M=(0,p.createServer)(O);O.use((0,u.default)("tiny")),O.use((0,d.default)()),O.use(c.default.json()),O.use(c.default.urlencoded({extended:!0})),O.use((0,f.default)()),O.use((0,l.default)({useTempFiles:!0,limits:{fileSize:52428800}})),(0,v.default)(O);const k=new h.Server(M,{cors:{origin:"*"}});k.use(g.checkJWTForIO),(0,w.initSocket)(k),n.c[n.s]===e&&M.listen(b,(()=>r(void 0,void 0,void 0,(function*(){yield _.startup(),console.log("📕 [redis]: Connected to redis"),yield y.connect(),console.log("📒 [mongo]: Connected to mysql"),console.log(`✅ [server]: Server is running at http://localhost:${b}`)})))),t.default=O},322:function(e,t,n){var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,a)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return a(t,e),t},r=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function r(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}c((i=i.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.checkJWTForIO=t.checkJWT=void 0;const c=o(n(9344)),d=s(n(5343)),u=n(5326),l=s(n(4947));t.checkJWT=function(e,t,n){return r(this,void 0,void 0,(function*(){const i=this&&"query"===this.tokenOn?e.query.token:e.cookies.token;if(!i)return t.sendStatus(401);try{const e=c.verify(i,d.default.JWT_KEY),a=yield l.default.getVersion(e.uid);if(a&&a!==e.version)return t.sendStatus(401);t.locals.user=e,n()}catch(i){if(!(i instanceof c.TokenExpiredError))return console.log(i),t.sendStatus(401);(0,u.checkRWT)(e,t,n)}}))},t.checkJWTForIO=function(e,t){const n=e.handshake.query.token;n||t(new Error("Unauthorized access token"));try{const i=c.verify(n,d.default.JWT_CHAT);e.user=i,t()}catch(e){t(new Error("Unauthorized access token"))}}},5326:function(e,t,n){var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,a)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return a(t,e),t},r=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function r(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}c((i=i.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.checkRWT=void 0;const c=o(n(9344)),d=s(n(5343)),u=n(7797),l=s(n(4947)),f=n(4742),h=s(n(9412));t.checkRWT=function(e,t,n){return r(this,void 0,void 0,(function*(){const i=e.cookies.refresh_token;(0,h.default)(t,(()=>r(this,void 0,void 0,(function*(){if(!i||!(yield l.default.getRefreshToken(i)))return t.sendStatus(401);try{const e=c.verify(i,d.default.JWT_REFRESH_KEY);e.role=yield l.default.getRole(e.uid),e.version=yield l.default.getVersion(e.uid);const a=(0,u.generateToken)(e,!0);yield l.default.insertRefreshToken(a.refreshToken,e.uid,e.role),t.cookie("refresh_token",a.refreshToken,(0,f.withAge)(864e5)).cookie("token",a.accessToken,(0,f.withAge)(e.remember?36e5:void 0)).locals.user=e,n()}catch(e){console.log(e),t.sendStatus(401)}}))))}))}},944:function(e,t){var n=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function r(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.checkRole=void 0,t.checkRole=function(e,t,i){return n(this,void 0,void 0,(function*(){const{role:e}=t.locals.user;if(!e||!this.role.includes(e))return t.sendStatus(401);i()}))}},5215:function(e,t,n){var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,a)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return a(t,e),t},r=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function r(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const s=n(6820),c=o(n(8432));t.default=class{static findUserByPassword(e,t){return r(this,void 0,void 0,(function*(){const n=yield s.UserBaseModel.findOne({username:e},{_id:1,role:1,username:1,password:1,name:1}).exec();if(!n)return;const{_id:i,username:a,password:o,role:r,name:d}=n;return t?(yield c.compare(t,o))&&{uid:i.toString(),username:a,role:r,name:d}:void 0}))}static findUserByInfo(e){return r(this,void 0,void 0,(function*(){const t=yield s.UserBaseModel.findOne({$or:[{username:e.username},{email:e.email},{_id:e.uid}]},{email:!0,username:!0,phone:!0,_id:!0}).exec();if(!t)return;const{username:n,_id:i,email:a}=t;return{username:n,uid:i.toString(),email:a}}))}}},9723:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ClassBaseModel=void 0;const i=n(1185),a=n(2412);t.ClassBaseModel=(0,i.model)("Class",a.ClassSchema)},6479:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DepartmentBaseModel=void 0;const i=n(1185),a=n(4448);t.DepartmentBaseModel=(0,i.model)("Department",a.DepartmentSchema)},6295:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EvaluationBaseModel=void 0;const i=n(1185),a=n(2438);t.EvaluationBaseModel=(0,i.model)("Evaluation",a.EvaluationSchema)},1217:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LabBaseModel=void 0;const i=n(1185),a=n(7581);t.LabBaseModel=(0,i.model)("Lab",a.LabSchema)},3069:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MessageBaseModel=void 0;const i=n(1185),a=n(2045);t.MessageBaseModel=(0,i.model)("Message",a.MessageSchema)},2649:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OutstandingBaseModel=void 0;const i=n(1185),a=n(6638);t.OutstandingBaseModel=(0,i.model)("Outstanding",a.OutstandingSchema)},7964:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RoomBaseModel=void 0;const i=n(1185),a=n(9978);t.RoomBaseModel=(0,i.model)("ChatRoom",a.RoomSchema)},1778:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.StudentBaseModel=void 0;const a=n(1185),o=i(n(4315));t.StudentBaseModel=(0,a.model)("Student",o.default)},18:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TeacherBaseModel=void 0;const i=n(1185),a=n(1868);t.TeacherBaseModel=(0,i.model)("Teacher",a.TeacherSchema)},6820:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.UserBaseModel=void 0;const a=n(1185),o=i(n(5102));t.UserBaseModel=(0,a.model)("User",o.default)},2237:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function r(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const a=n(9723);t.default=class{static create(e){return i(this,void 0,void 0,(function*(){const{creator:t,description:n,name:i,students:o,teacher:r,classID:s}=e;return(yield a.ClassBaseModel.create({creator:t,description:n,name:i,students:o,teacher:r,classID:s,rating:4.8,comments:[]}))._id.toString()}))}static delete(e){return i(this,void 0,void 0,(function*(){return(yield a.ClassBaseModel.deleteOne({_id:e}).exec()).acknowledged}))}static search(e){return i(this,void 0,void 0,(function*(){return(yield a.ClassBaseModel.search({match:{name:{query:e,fuzziness:"auto",fuzzy_transpositions:!0}}},{hydrate:!0,hydrateOptions:{select:"name _id"}})).body.hits.hydrated}))}static get(e){return i(this,void 0,void 0,(function*(){return yield a.ClassBaseModel.find({_id:{$in:e}}).exec()}))}static addComment(e,t){return i(this,void 0,void 0,(function*(){return(yield a.ClassBaseModel.updateOne({_id:e},{$push:{comments:{creator:t.creator,content:t.content}}})).acknowledged}))}static deleteComment(e,t){return i(this,void 0,void 0,(function*(){return(yield a.ClassBaseModel.updateOne({_id:e},{$pull:{comments:{_id:t.cid,creator:t.creator}}})).acknowledged}))}}},7148:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function r(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const a=n(6479);t.default=class{static create(e){return i(this,void 0,void 0,(function*(){const{name:t,dean:n,description:i,contact:o,details:r,image:s,creator:c}=e;return(yield a.DepartmentBaseModel.create({name:t,dean:n,description:i,contact:o,details:r,image:s,creator:c}))._id}))}static delete(e){return i(this,void 0,void 0,(function*(){return(yield a.DepartmentBaseModel.deleteOne({_id:e}).exec()).acknowledged}))}static search(e){return i(this,void 0,void 0,(function*(){return(yield a.DepartmentBaseModel.search({match:{name:{query:e,fuzziness:"auto",fuzzy_transpositions:!0}}},{hydrate:!0,hydrateOptions:{select:"name _id"}})).body.hits.hydrated}))}static get(e){return i(this,void 0,void 0,(function*(){return yield a.DepartmentBaseModel.find({_id:{$in:e}}).exec()}))}static getAllName(){return i(this,void 0,void 0,(function*(){return(yield a.DepartmentBaseModel.find().exec()).map((e=>({name:e.name,id:e._id})))}))}}},827:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function r(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const a=n(6295);t.default=class{static create(e,t){return i(this,void 0,void 0,(function*(){const{creator:n,classID:i}=t;return(yield a.EvaluationBaseModel.insertMany(e.map((e=>({classID:i,creator:n,participant:e,criteria:[],isDone:!1,isOpen:!1}))))).map((e=>e._id))}))}static delete(e,t){return i(this,void 0,void 0,(function*(){return(yield a.EvaluationBaseModel.deleteMany({participant:{$in:e},classID:t}).exec()).acknowledged}))}static update(e){return i(this,void 0,void 0,(function*(){const{criteria:t,classID:n,participant:i}=e;return(yield a.EvaluationBaseModel.updateOne({classID:n,participant:i},{criteria:t,isDone:!0})).acknowledged}))}}},608:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function r(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const a=n(1217);t.default=class{static create(e){return i(this,void 0,void 0,(function*(){const{name:t,dean:n,description:i,contact:o,details:r,image:s,creator:c,department:d}=e;return(yield a.LabBaseModel.create({name:t,dean:n,description:i,contact:o,details:r,image:s,creator:c,department:d}))._id}))}static delete(e){return i(this,void 0,void 0,(function*(){return(yield a.LabBaseModel.deleteOne({_id:e}).exec()).acknowledged}))}static search(e){return i(this,void 0,void 0,(function*(){return(yield a.LabBaseModel.search({match:{name:{query:e,fuzziness:"auto",fuzzy_transpositions:!0}}},{hydrate:!0,hydrateOptions:{select:"name _id"}})).body.hits.hydrated}))}static get(e){return i(this,void 0,void 0,(function*(){return yield a.LabBaseModel.find({_id:{$in:e}}).exec()}))}}},6815:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function r(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.MessageModel=void 0;const a=n(2045),o=n(3069),r=n(1185);t.MessageModel=class{static createMessage(e,t,n,r=a.EMessageType.TEXT){return i(this,void 0,void 0,(function*(){return(yield o.MessageBaseModel.create({roomID:e,message:n,type:r,creator:t}))._id}))}static getConversation(e){return i(this,void 0,void 0,(function*(){return yield o.MessageBaseModel.aggregate([{$match:{roomID:{$eq:new r.Types.ObjectId(e)}}},{$sort:{createdAt:-1}}]).exec()}))}}},8101:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function r(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const a=n(2649);t.default=class{static create(e){return i(this,void 0,void 0,(function*(){const{creator:t,image:n,ref:i,type:o}=e;return(yield a.OutstandingBaseModel.create({creator:t,image:n,ref:i,type:o}))._id}))}static delete(e){return i(this,void 0,void 0,(function*(){return(yield a.OutstandingBaseModel.deleteOne({_id:e}).exec()).acknowledged}))}static get(){return i(this,void 0,void 0,(function*(){return yield a.OutstandingBaseModel.find().exec()}))}static getAll(){return i(this,void 0,void 0,(function*(){return yield a.OutstandingBaseModel.find().exec()}))}}},6362:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function r(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}c((i=i.apply(e,t||[])).next())}))},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=n(7964);var r=a(n(1185)).default.Types.ObjectId;t.default=new class{findByParticipants(e){return i(this,void 0,void 0,(function*(){return(yield o.RoomBaseModel.findOne({participants:{$size:e.length,$all:[...e]}}).exec())||void 0}))}createRoom(e,t,n){return i(this,void 0,void 0,(function*(){return t.push(e),yield o.RoomBaseModel.create({initiator:e,participants:t,name:n||"New chat",room_type:t.length>2?"group":"P2P"})}))}deleteRoom(e,t){return i(this,void 0,void 0,(function*(){return(yield o.RoomBaseModel.deleteOne({_id:e,initiator:t}).exec()).deletedCount>0&&e}))}getRoom(e,t){return i(this,void 0,void 0,(function*(){return yield o.RoomBaseModel.findOne({_id:e,participants:{$in:[t]}}).exec()}))}getAllRooms(e){return i(this,void 0,void 0,(function*(){return yield o.RoomBaseModel.find({participants:{$in:[e]}})}))}updateRoom(e,t,n){return i(this,void 0,void 0,(function*(){return(yield o.RoomBaseModel.updateOne({_id:e,participants:{$elemMatch:{$eq:new r(t)}}},{name:n}).exec()).modifiedCount>0&&e}))}}},3612:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AwardSchema=void 0;const i=n(1185);t.AwardSchema=new i.Schema({name:{type:String,required:!0},color:{type:String,required:!0}})},2412:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ClassSchema=void 0;const a=n(1185),o=i(n(3464)),r=n(7629),s=new a.Schema({name:{type:String,required:!0,es_index:!0},classID:{type:String,required:!0,es_index:!0},teacher:{type:a.Schema.Types.ObjectId,required:!0},description:{type:String},creator:{type:a.Schema.Types.ObjectId,required:!0},students:{type:[a.Schema.Types.ObjectId],required:!0},rating:{type:Number,required:!0},comments:{type:[r.CommentSchema],required:!0}},{timestamps:!0});t.ClassSchema=s,s.plugin(o.default)},7629:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CommentSchema=void 0;const i=n(1185);t.CommentSchema=new i.Schema({creator:{type:i.Schema.Types.ObjectId,required:!0},content:{type:String,required:!0}},{timestamps:!0})},6304:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ContactSchema=void 0;const i=n(1185);t.ContactSchema=new i.Schema({phones:{type:[String],required:!0},emails:{type:[String],required:!0},social:{type:[String]}})},4448:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.DepartmentSchema=void 0;const a=n(1185),o=n(6304),r=n(4919),s=i(n(3464)),c=new a.Schema({name:{type:String,required:!0,es_index:!0},dean:{type:a.Schema.Types.ObjectId,required:!0},description:{type:String},contact:{type:o.ContactSchema,required:!0},details:{type:[r.DetailSchema],required:!0},image:{type:String,required:!0},creator:{type:a.Schema.Types.ObjectId,required:!0}});t.DepartmentSchema=c,c.plugin(s.default)},4919:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DetailSchema=void 0;const i=n(1185);t.DetailSchema=new i.Schema({title:{type:String,required:!0},content:{type:[String],required:!0}})},2438:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EvaluationSchema=t.CriteriaSchema=t.ESatisfactionLevel=void 0;const i=n(1185);var a;!function(e){e[e.VERY_GOOD=5]="VERY_GOOD",e[e.GOOD=4]="GOOD",e[e.MEDIUM=3]="MEDIUM",e[e.BAD=2]="BAD",e[e.VERY_BAD=1]="VERY_BAD"}(a||(t.ESatisfactionLevel=a={})),t.CriteriaSchema=new i.Schema({name:{type:String,required:!0},value:{type:Number}}),t.EvaluationSchema=new i.Schema({creator:{type:i.Schema.Types.ObjectId,required:!0},participant:{type:i.Schema.Types.ObjectId,required:!0},classID:{type:i.Schema.Types.ObjectId,required:!0},criteria:{type:[t.CriteriaSchema],required:!0},isDone:{type:i.Schema.Types.Boolean,required:!0},isOpen:{type:i.Schema.Types.Boolean,required:!0}})},9125:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FavoriteSchema=t.EFavouriteType=void 0;const i=n(1185);var a;!function(e){e.TEACHER="teacher",e.LAB="lab",e.DEPARTMENT="department"}(a||(t.EFavouriteType=a={}));const o=new i.Schema({name:{type:String,required:!0},type:{type:String,required:!0},ref:{type:i.Schema.Types.ObjectId}},{timestamps:!0});t.FavoriteSchema=o},7581:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.LabSchema=void 0;const a=n(1185),o=n(6304),r=n(4919),s=i(n(3464)),c=new a.Schema({name:{type:String,required:!0,es_index:!0},dean:{type:a.Schema.Types.ObjectId,required:!0},description:{type:String},contact:{type:o.ContactSchema,required:!0},details:{type:[r.DetailSchema],required:!0},image:{type:String,required:!0},creator:{type:a.Schema.Types.ObjectId,required:!0},department:{type:a.Schema.Types.ObjectId,required:!0}});t.LabSchema=c,c.plugin(s.default)},2045:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MessageSchema=t.EMessageType=void 0;const i=n(1185),a=n(6820),o=n(7964);var r;!function(e){e.TEXT="text",e.IMAGE="image",e.DELETED="deleted"}(r||(t.EMessageType=r={})),t.MessageSchema=new i.Schema({message:{type:String,require:!0},type:{type:String,default:r.TEXT},creator:{type:i.Schema.Types.ObjectId,required:!0,ref:a.UserBaseModel},roomID:{type:i.Schema.Types.ObjectId,required:!0,ref:o.RoomBaseModel}},{timestamps:!0})},6638:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OutstandingSchema=t.EOutstandingType=void 0;const i=n(1185),a=n(6820);var o;!function(e){e.TEACHER="teacher",e.DEPARTMENT="department",e.LAB="lab"}(o||(t.EOutstandingType=o={}));const r=new i.Schema({image:{type:String,required:!0},ref:{type:i.Schema.Types.ObjectId,required:!0},creator:{type:i.Schema.Types.ObjectId,ref:a.UserBaseModel},type:{type:String,required:!0}},{timestamps:!0});t.OutstandingSchema=r},9978:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RoomSchema=void 0;const a=i(n(1185));var o=a.default.Types.ObjectId;t.RoomSchema=new a.default.Schema({participants:[{type:o,required:!0}],initiator:{type:o,required:!0},name:String,room_type:{type:String,required:!0}},{timestamps:!0})},4315:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=n(1185),a=new i.Schema({name:{type:String,required:!0},user:{type:i.Schema.Types.ObjectId,required:!0},department:{type:i.Schema.Types.ObjectId,required:!0},creator:{type:i.Schema.Types.ObjectId,required:!0},classes:{type:[i.Schema.Types.ObjectId],required:!0}},{timestamps:!0});t.default=a},1868:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.TeacherSchema=void 0;const a=n(1185),o=n(6304),r=n(4919),s=i(n(3464)),c=n(1217),d=n(6479),u=n(3612),l=new a.Schema({department:{type:a.Schema.Types.ObjectId,ref:d.DepartmentBaseModel},lab:{type:a.Schema.Types.ObjectId,ref:c.LabBaseModel},name:{type:String,required:!0,es_indexed:!0},description:{type:String},awards:{type:[u.AwardSchema]},contact:{type:o.ContactSchema},details:{type:[r.DetailSchema]},image:{type:String},creator:{type:a.Schema.Types.ObjectId,required:!0},user:{type:a.Schema.Types.ObjectId,required:!0},classes:{type:[a.Schema.Types.ObjectId],required:!0},position:{type:[String],required:!0}});t.TeacherSchema=l,l.plugin(s.default)},9372:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function r(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.setTokenIndex=t.schema=void 0;const a=n(9818),o=n(7773);t.schema={"$.token":{type:o.SchemaFieldTypes.TEXT,AS:"token"},"$.uid":{type:o.SchemaFieldTypes.TEXT,AS:"uid"}},t.setTokenIndex=function(){return i(this,void 0,void 0,(function*(){try{yield a.redis.ft.create("idx:token",t.schema,{ON:"JSON",PREFIX:"token_"})}catch(e){"Index already exists"===e.message?console.log("Index idx:token exists already, skipped creation."):console.error(e)}}))}},5102:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=n(1185),a=n(9125),o=new i.Schema({username:{type:String,required:!0,unique:!0,index:!0},password:{type:String,required:!0},role:{type:String,required:!0},version:{type:Number,required:!0},email:{type:String,unique:!0,index:!0},creator:{type:i.Schema.Types.ObjectId},name:{type:String,required:!0},favorites:{type:[a.FavoriteSchema],required:!0}});t.default=o},7315:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function r(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const a=n(1778);t.default=class{static create(e){return i(this,void 0,void 0,(function*(){const{name:t,user:n,department:i,creator:o}=e;return(yield a.StudentBaseModel.create({name:t,user:n,department:i,creator:o,classes:[]}))._id.toString()}))}static delete(e){return i(this,void 0,void 0,(function*(){return(yield a.StudentBaseModel.deleteOne({user:e}).exec()).acknowledged}))}static update(e,t){return i(this,void 0,void 0,(function*(){const{name:n,user:i,department:o}=t;return(yield a.StudentBaseModel.updateOne({user:e},{name:n,user:i,department:o})).acknowledged}))}static get(e){return i(this,void 0,void 0,(function*(){return yield a.StudentBaseModel.find({user:{$in:e}}).exec()}))}static addClass(e,t){return i(this,void 0,void 0,(function*(){return(yield a.StudentBaseModel.updateMany({user:{$in:e}},{$push:{classes:t}})).acknowledged}))}static deleteClass(e,t){return i(this,void 0,void 0,(function*(){return(yield a.StudentBaseModel.updateMany({user:{$in:e}},{$pull:{classes:t}})).acknowledged}))}}},9660:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function r(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const a=n(18);t.default=class{static create(e){return i(this,void 0,void 0,(function*(){const{name:t,lab:n,department:i,description:o,awards:r,details:s,contact:c,image:d,creator:u,user:l}=e;return(yield a.TeacherBaseModel.create({name:t,lab:n,department:i,description:o,awards:r,details:s,contact:c,image:d,creator:u,user:l,classes:[],position:["Giảng viên"]}))._id.toString()}))}static delete(e){return i(this,void 0,void 0,(function*(){return(yield a.TeacherBaseModel.deleteOne({user:e}).exec()).acknowledged}))}static update(e,t){return i(this,void 0,void 0,(function*(){const{department:n,lab:i,description:o,details:r,contact:s,image:c}=t;return(yield a.TeacherBaseModel.updateOne({user:e},{department:n,lab:i,description:o,details:r,contact:s,image:c})).acknowledged}))}static search(e){return i(this,void 0,void 0,(function*(){return(yield a.TeacherBaseModel.search({match:{name:{query:e,fuzziness:"auto",fuzzy_transpositions:!0}}},{hydrate:!0,hydrateOptions:{select:"name _id"}})).body.hits.hydrated}))}static addClass(e,t){return i(this,void 0,void 0,(function*(){return(yield a.TeacherBaseModel.updateOne({user:e},{$push:{classes:t}})).acknowledged}))}static deleteClass(e,t){return i(this,void 0,void 0,(function*(){return(yield a.TeacherBaseModel.updateOne({user:e},{$pull:{classes:t}})).acknowledged}))}static get(e){return i(this,void 0,void 0,(function*(){return yield a.TeacherBaseModel.find({user:{$in:e}}).exec()}))}static getByDepartment(e){return i(this,void 0,void 0,(function*(){return(yield a.TeacherBaseModel.find({department:{$in:e}}).exec()).map((e=>({id:e._id,name:e.name,department:e.department,awards:e.awards.map((e=>({name:e.name,color:e.color}))),position:e.position,image:e.image})))}))}static getAll(){return i(this,void 0,void 0,(function*(){return(yield a.TeacherBaseModel.find({}).exec()).map((e=>({id:e._id,name:e.name,awards:e.awards,department:e.department})))}))}}},4947:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function r(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const a=n(9818),o=n(4816);t.default=class{static insertRefreshToken(e,t,n){return i(this,void 0,void 0,(function*(){if(yield a.redis.set((0,o.getKey)(t,o.NameType.USER_VERSION),0,{NX:!0}),"OK"!==(yield a.redis.json.set((0,o.getKey)(e,o.NameType.TOKEN),"$",{uid:t,token:e}))||"OK"!==(yield a.redis.set((0,o.getKey)(t,o.NameType.USER_ROLE),n)))throw new Error("Unable to add refresh token")}))}static getRefreshToken(e){return i(this,void 0,void 0,(function*(){return yield a.redis.json.get((0,o.getKey)(e,o.NameType.TOKEN))}))}static deleteRefreshToken(e){return i(this,void 0,void 0,(function*(){const t=yield a.redis.ft.search("idx:token",`@uid:"${e}"`);t&&(yield Promise.all(t.documents.map((e=>a.redis.json.del(e.id)))))}))}static updateVersion(e){if(!a.redis.incr((0,o.getKey)(e,o.NameType.USER_VERSION)))throw new Error("Unable to update version")}static getVersion(e){return i(this,void 0,void 0,(function*(){return yield a.redis.get((0,o.getKey)(e,o.NameType.USER_VERSION))}))}static getRole(e){return i(this,void 0,void 0,(function*(){return yield a.redis.get((0,o.getKey)(e,o.NameType.USER_ROLE))}))}}},5805:function(e,t,n){var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,a)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return a(t,e),t},r=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function r(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const s=n(6820),c=o(n(8432));t.default=class{static validateUID(e){return r(this,void 0,void 0,(function*(){const t=Array.from(new Set(e)),n=(yield s.UserBaseModel.find({_id:{$in:t}},{_id:1}).exec()).map((e=>e._id.toString()));return t.every((e=>n.includes(e)))}))}static getUsers(e){return r(this,void 0,void 0,(function*(){const t=yield s.UserBaseModel.find({_id:{$in:e}},{email:!0,username:!0,_id:!0,role:1,name:1}).exec();if(t)return t.map((e=>{const{username:t,_id:n,email:i,role:a}=e;return{username:t,uid:n,email:i,role:a}}))}))}static create(e){return r(this,void 0,void 0,(function*(){const{username:t,role:n,name:i,creator:a}=e;return(yield s.UserBaseModel.create({username:t,role:n,creator:a,name:i,version:0,favorites:[],email:t+"@vnu.edu.vn",password:yield c.hash("123456789",10)}))._id.toString()}))}static delete(e){return r(this,void 0,void 0,(function*(){return(yield s.UserBaseModel.deleteOne({_id:e})).acknowledged}))}static addFavorite(e,t){return r(this,void 0,void 0,(function*(){return(yield s.UserBaseModel.updateOne({_id:e},{$push:{favorites:{name:t.name,ref:t.ref,type:t.type}}})).acknowledged}))}static getFavourites(e){return r(this,void 0,void 0,(function*(){const t=yield s.UserBaseModel.findOne({_id:e},{favorites:1}).exec();return t?t.favorites:[]}))}}},8479:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(n(8961));t.default=function(e){e.use("/v1",a.default)}},9413:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(n(6860)),o=i(n(6464)),r=n(322),s=n(944),c=a.default.Router();c.post("/login",o.default.login),c.post("/logout",[r.checkJWT],o.default.logout),c.post("/create",[r.checkJWT,s.checkRole.bind({role:["admin"]})],o.default.create),c.delete("/:id",[r.checkJWT],s.checkRole.bind({role:["admin"]}),o.default.delete),t.default=c},9171:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=n(8665),a=n(6319),o=n(322),r=(0,n(6860).Router)();r.get("/token",[o.checkJWT],a.MessageChatController.generateChatToken),r.get("/",[o.checkJWT],i.RoomController.getAllRooms),r.post("/",[o.checkJWT],i.RoomController.createRoom),r.get("/:roomID",[o.checkJWT],i.RoomController.getRoomByID),r.put("/:roomID",[o.checkJWT],i.RoomController.updateRoomName),r.delete("/:roomID",[o.checkJWT],i.RoomController.deleteRoom),r.post("/:roomID/msg",[o.checkJWT],a.MessageChatController.createMessage),t.default=r},2669:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(n(7022)),o=n(322),r=n(944),s=(0,n(6860).Router)();s.post("/",[o.checkJWT,r.checkRole.bind({role:["admin"]})],a.default.create),s.delete("/:id",[o.checkJWT,r.checkRole.bind({role:["admin"]})],a.default.delete),s.post("/:id/comment",[o.checkJWT],a.default.addComment),s.delete("/:id/comment/:cid",[o.checkJWT],a.default.deleteComment),t.default=s},4408:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(n(8964)),o=n(322),r=n(944),s=(0,n(6860).Router)();s.post("/",[o.checkJWT,r.checkRole.bind({role:["admin"]})],a.default.create),s.delete("/:id",[o.checkJWT,r.checkRole.bind({role:["admin"]})],a.default.delete),s.get("/name",[o.checkJWT],a.default.getAllDepartmentsName),t.default=s},1175:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(n(5409)),o=n(322),r=n(944),s=(0,n(6860).Router)();s.put("/:clid",[o.checkJWT,r.checkRole.bind({role:["admin","student"]})],a.default.update),t.default=s},8961:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=n(6860),o=i(n(9413)),r=i(n(9171)),s=i(n(8114)),c=i(n(4408)),d=i(n(6785)),u=i(n(7471)),l=i(n(496)),f=i(n(2669)),h=i(n(1175)),p=i(n(9792)),v=(0,a.Router)();v.use("/chat",r.default),v.use("/auth",o.default),v.use("/outstanding",s.default),v.use("/department",c.default),v.use("/lab",d.default),v.use("/search",u.default),v.use("/class",f.default),v.use("/me",l.default),v.use("/evaluation",h.default),v.use("/teacher",p.default),t.default=v},6785:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(n(1329)),o=n(322),r=n(944),s=(0,n(6860).Router)();s.post("/",[o.checkJWT,r.checkRole.bind({role:["admin"]})],a.default.create),s.delete("/:id",[o.checkJWT,r.checkRole.bind({role:["admin"]})],a.default.delete),t.default=s},496:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(n(4107)),o=n(322),r=(0,n(6860).Router)();r.get("/",[o.checkJWT],a.default.getProfile),r.get("/favourite",[o.checkJWT],a.default.getFavorite),r.post("/favourite",[o.checkJWT],a.default.addFavorite),t.default=r},8114:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(n(4340)),o=n(322),r=n(944),s=(0,n(6860).Router)();s.post("/",[o.checkJWT,r.checkRole.bind({role:["admin"]})],a.default.create),s.delete("/:id",[o.checkJWT,r.checkRole.bind({role:["admin"]})],a.default.delete),s.get("/",[o.checkJWT],a.default.getAll),t.default=s},7471:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(n(7782)),o=n(322),r=(0,n(6860).Router)();r.get("/",[o.checkJWT],a.default.search),t.default=r},9792:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(n(466)),o=n(322),r=(0,n(6860).Router)();r.get("/",[o.checkJWT],a.default.getAll),t.default=r},5194:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.initSocket=void 0;const i=n(6815);t.initSocket=function(e){e.on("connection",(e=>{console.log("Connected");const t=e.user;e.emit("user",t),e.on("join",(t=>{console.log("Changed to room",t),e.join(t)})),e.on("chat",(({content:t,to:n})=>{console.log(t,n),n&&i.MessageModel.createMessage(n,e.user.uid,t.message,t.type),e.to(n).emit("chat",{content:t,from:e.user.uid})})),e.on("disconnect",(()=>{console.log("Disconnected")}))}))}},2790:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.EUserRole=void 0,function(e){e.ADMIN="admin",e.TEACHER="teacher",e.STUDENT="student"}(n||(t.EUserRole=n={}))},5417:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.InputError=void 0;class n extends Error{constructor(e,t,i){super(e),Object.setPrototypeOf(this,n.prototype),this.field=t,this.value=i}}t.InputError=n},7797:function(e,t,n){var i=this&&this.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(n[i[a]]=e[i[a]])}return n},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.generate_password=t.generateResetToken=t.generateToken=t.generate_uid=void 0;const o=n(9344),r=a(n(5343)),s=n(1633);function c(e,t){return Math.floor(Math.random()*(t-e))+e}t.generate_uid=function(e=8){return e=e>0?e:8,[...new Array(e)].map((()=>c(0,9).toString())).join("")},t.generateToken=function(e,t){const n=e,{iat:a,exp:c}=n,d=i(n,["iat","exp"]);return{accessToken:(0,o.sign)(d,r.default.JWT_KEY,s.JWTTokenOpt),refreshToken:t&&(0,o.sign)(d,r.default.JWT_REFRESH_KEY,s.JWTRefreshOpt)}},t.generateResetToken=function(e){const t=e,{iat:n,exp:a}=t,c=i(t,["iat","exp"]);return(0,o.sign)(c,r.default.JWT_RESET_KEY,s.JWTResetOpt)},t.generate_password=function(e=8){e=e>0?e:8;return[...new Array(e)].map((()=>"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890"[c(0,61)])).join("")}},9412:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function r(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const a=n(5417);t.default=function(e,t){return i(this,void 0,void 0,(function*(){try{yield t()}catch(t){console.log(t),t instanceof a.InputError?e.status(400).json({message:t.message,name:t.field}):e.sendStatus(500)}}))}},4816:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.getKey=t.NameType=void 0,function(e){e[e.USER_VERSION=0]="USER_VERSION",e[e.USER_ROLE=1]="USER_ROLE",e[e.TOKEN=2]="TOKEN"}(n||(t.NameType=n={})),t.getKey=function(e,t){return t===n.USER_VERSION&&e+"_v"||t===n.USER_ROLE&&e+"_r"||t===n.TOKEN&&"token_"+e||e}},4747:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=n(5417),o=i(n(3389));class r extends o.default{static checkUsername(e,t){if(e){if(e.length<3||e.length>50)throw new a.InputError("Username có độ dài từ 3 đến 50 ký tự","username")}else if(!t)throw new a.InputError("Must include username","username")}static checkPassword(e){if(!e||e.length<8||e.length>50)throw new a.InputError("Mật khẩu có độ dài từ 8 đến 50 ký tự","password")}static validateLogin(e){this.checkUsername(e.username),this.checkPassword(e.password)}}t.default=r},3389:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=n(2790),a=n(5417);t.default=class{static checkUnd(e,t,n,i=n){if(!e&&!t)throw new a.InputError("Must include "+i,n)}static checkTypeEnum(e,t,n,i,o=i){if(this.checkUnd(t,n,i,o),!Object.values(e).includes(t))throw new a.InputError("Invalid "+o,i,t)}static checkArray(e,t,n,i=n){if(this.checkUnd(e,t,n,i),e&&!Array.isArray(e))throw new a.InputError(i+" must be an array",n)}static checkName(e,t,n="name",i=n){if(this.checkUnd(e,t,n,i),!e||e.length<5)throw new a.InputError("Invalid "+i,n)}static checkId(e,t,n="id",i=n){if(this.checkUnd(e,t,n,i),e&&24!=e.length)throw new a.InputError("Invalid "+i,n)}static checkPhone(e,t,n="phone",i=n){if(this.checkUnd(e,t,n,i),10!==e.length||!e.startsWith("0"))throw new a.InputError("Invalid "+i,n)}static checkEmail(e,t,n="email",i=n){if(this.checkUnd(e,t,n,i),!/^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/.test(e))throw new a.InputError("Invalid "+i,n)}static checkLink(e,t,n="link",i=n){if(this.checkUnd(e,t,n,i),!/[(http(s)?):\/\/(www\.)?a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/.test(e))throw new a.InputError("Invalid "+i,n)}static checkFile(e,t,n="file",i=n){this.checkUnd(e,t,n,i)}static checkRole(e,t){this.checkTypeEnum(i.EUserRole,e,t,"role")}static checkContact(e,t){if(this.checkUnd(e,t,"contact"),e){if(!e.phones||!Array.isArray(e.phones))throw new a.InputError("Contact phones must be an array","contact.phones");if(!e.emails||!Array.isArray(e.emails))throw new a.InputError("Contact emails must be an array","contact.emails");if(e.social&&!Array.isArray(e.social))throw new a.InputError("Contact social must be an array","contact.social");e.phones.forEach((e=>this.checkPhone(e,!1,"contact.phones","phone"))),e.emails.forEach((e=>this.checkEmail(e,!1,"contact.emails","email"))),e.social&&e.social.forEach((e=>this.checkLink(e,!1,"contact.social","social")))}}static checkDetail(e,t){this.checkArray(e,t,"detail"),e&&e.forEach((e=>{this.checkName(e.title,!1,"detail[].title","title"),this.checkArray(e.content,!1,"detail[].content","content"),e.content.forEach((e=>this.checkName(e,!1,"detail[].content","content")))}))}}},4216:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ChatValidator=void 0;const a=n(2045),o=i(n(3389));class r extends o.default{static validateCreateRoom(e){this.checkArray(e.participants,!1,"participants")}static validateDeleteRoom(e){this.checkId(e.roomID,!1,"roomID")}static validateGetRoom(e){this.checkId(e.roomID,!1,"roomID")}static validateUpdateRoom(e){this.checkId(e.roomID,!1,"roomID")}static validateCreateMessage(e){this.checkId(e.roomID,!1,"roomID"),this.checkTypeEnum(a.EMessageType,e.type,!0,"type","message type")}}t.ChatValidator=r},3211:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=n(5417),o=i(n(3389));class r extends o.default{static checkStudent(e,t){if(e){if(!Array.isArray(e))throw new a.InputError("students must be an array","students");e.forEach((e=>this.checkId(e)))}else if(!t)throw new a.InputError("Must include students list","students")}static checkClassID(e,t){if(e);else if(!t)throw new a.InputError("Must include class ID","classID")}static validateCreate(e){this.checkName(e.name),this.checkId(e.teacher),this.checkClassID(e.classID),this.checkStudent(e.students)}static validateDelete(e){this.checkId(e.id)}}t.default=r},4003:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(n(3389));class o extends a.default{static validateCreate(e){this.checkId(e.id),this.checkName(e.content)}static validateDelete(e){this.checkId(e.id),this.checkId(e.cid)}}t.default=o},9416:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(n(3389));class o extends a.default{static validateCreate(e){this.checkName(e.name),this.checkId(e.dean),this.checkFile(e.image),this.checkContact(e.contact),this.checkDetail(e.details)}static validateDelete(e){this.checkId(e.id)}}t.default=o},8103:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=n(5417),o=i(n(3389)),r=n(2438);class s extends o.default{static checkCriteria(e,t){if(e){if(!Array.isArray(e))throw new a.InputError("Criteria must be an array","criteria");e.forEach((e=>{this.checkName(e.name),this.checkSatisfactionLevel(e.value)}))}else if(!t)throw new a.InputError("Must include a criteria","criteria")}static checkSatisfactionLevel(e,t){if(e){if(!Object.values(r.ESatisfactionLevel).includes(e))throw new a.InputError("Invalid satisfaction level","level")}else if(!t)throw new a.InputError("Must include satisfaction level","level")}static validateUpdate(e){this.checkCriteria(e.criteria)}}t.default=s},8937:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(n(3389));class o extends a.default{static validateCreate(e){this.checkName(e.name),this.checkId(e.dean),this.checkFile(e.image),this.checkContact(e.contact),this.checkDetail(e.details),this.checkId(e.department)}static validateDelete(e){this.checkId(e.id)}}t.default=o},1529:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(n(3389)),o=n(9125),r=n(5417);class s extends a.default{static checkFavouriteType(e,t){if(e){if(!Object.values(o.EFavouriteType).includes(e))throw new r.InputError("Invalid favourite type","type")}else if(!t)throw new r.InputError("Must include favorite type","type")}static validateAddFavourite(e){this.checkId(e.ref),this.checkFavouriteType(e.type),this.checkName(e.name)}}t.default=s},4539:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=n(5417),o=i(n(3389)),r=n(6638);class s extends o.default{static checkOutstandingType(e,t){if(e){if(!Object.values(r.EOutstandingType).includes(e))throw new a.InputError("Invalid outstanding type","type")}else if(!t)throw new a.InputError("Must included outstanding type","type")}static validateCreate(e){this.checkFile(e.image),this.checkId(e.ref),this.checkOutstandingType(e.type)}static validateDelete(e){this.checkId(e.id)}}t.default=s},8047:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(n(3389));class o extends a.default{static validateCreate(e){this.checkId(e.user,!1,"user"),this.checkId(e.department,!1,"department"),this.checkName(e.name)}static validateUpdate(e){}static validateDelete(e){this.checkId(e.id)}}t.default=o},7649:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(n(3389));class o extends a.default{static checkAwards(e,t){this.checkArray(e,t,"awards")}static validateCreate(e){this.checkId(e.user,!1,"user"),this.checkName(e.name),this.checkId(e.department,!0,"department"),this.checkId(e.lab,!0,"lab"),this.checkAwards(e.awards,!0),this.checkContact(e.contact,!0),this.checkDetail(e.details,!0),this.checkFile(e.image,!0,"image")}static validateUpdate(e){this.checkId(e.id),this.checkId(e.lab,!0),this.checkId(e.department,!0),this.checkContact(e.contact,!0),this.checkDetail(e.details,!0),this.checkFile(e.image,!0)}static validateDelete(e){this.checkId(e.id)}static validateGetByDepartment(e){this.checkArray(e.departments,!1,"departments"),e.departments.forEach((e=>this.checkId(e)))}}t.default=o},203:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=n(5417),o=i(n(3389));class r extends o.default{static checkUsername(e,t){if(e){if(e.length<3||e.length>50)throw new a.InputError("Username có độ dài từ 3 đến 50 ký tự","username")}else if(!t)throw new a.InputError("Must include username","username")}static validateCreate(e){this.checkName(e.name),this.checkUsername(e.username),this.checkRole(e.role)}static validateDelete(e){this.checkId(e.id)}}t.default=r},8432:e=>{e.exports=require("bcryptjs")},3518:e=>{e.exports=require("cloudinary")},9710:e=>{e.exports=require("cookie-parser")},5142:e=>{e.exports=require("dotenv")},6860:e=>{e.exports=require("express")},6674:e=>{e.exports=require("express-fileupload")},7806:e=>{e.exports=require("helmet")},9344:e=>{e.exports=require("jsonwebtoken")},3464:e=>{e.exports=require("mongoosastic")},1185:e=>{e.exports=require("mongoose")},9470:e=>{e.exports=require("morgan")},7773:e=>{e.exports=require("redis")},3952:e=>{e.exports=require("socket.io")},8849:e=>{e.exports=require("node:http")},1017:e=>{e.exports=require("path")}},t={};function n(i){var a=t[i];if(void 0!==a)return a.exports;var o=t[i]={id:i,loaded:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.loaded=!0,o.exports}n.c=t,n.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),n(n.s=3607)})();